parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"yaW9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston"));require("express-async-errors");const{combine:n,timestamp:a,label:l,printf:o}=t.default.format,s=o(({level:e,message:t,label:n,timestamp:a})=>`${a} [${n}] ${e}: ${t}`);function r(){t.default.exceptions.handle(new t.default.transports.File({filename:"uncaughtExceptions.log",handleExceptions:!1})),process.on("unhandledRejection",e=>{throw e}),t.default.add(new t.default.transports.File({filename:"logfile.log",format:n(l({label:"Dengine"}),a(),s)})),"production"!==process.env.NODE_ENV&&t.default.add(new t.default.transports.Console({format:t.default.format.simple()}))}exports.default=r;
},{}],"irtd":[function(require,module,exports) {
"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function t(t){for(var a=1;a<arguments.length;a++){var i=null!=arguments[a]?arguments[a]:{};a%2?e(Object(i),!0).forEach(function(e){n(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function n(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){var t=i(e,"string");return"symbol"==typeof t?t:String(t)}function i(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTC=exports.getSequence=exports.getXID=exports.getDomainName=exports.asyncRouteHandler=exports.convertPath=exports.getSidebar=exports.getViewUrl=exports.getReportUrl=exports.generateAuthToken=exports.asyncHandler=exports.NAME=exports.getXMlVersion=exports.capitalize=exports.getFileData=exports.CONSTS=void 0;const o=r(require("fs")),s=r(require("util")),c=r(require("config")),l=r(require("jsonwebtoken")),m=r(require("random-string-generator")),p=s.default.promisify(o.default.readFile),u=e=>["user","settings","transmission",...e.split(",").map(_())];function _(){return e=>e.trim().replace(" ","-").toLowerCase()}function D(e,t,n){return e.replace(new RegExp(t,"g"),n)}exports.CONSTS={JWT_PRIVATE_KEY:"production"===process.env.NODE_ENV?m.default("alphanumeric"):"sfeefv",DB:c.default.get("db"),DEV_INSTANCEURL:c.default.get("devInstanceURL"),TEST_INSTANCEURL:c.default.get("testInstanceURL"),PROD_INSTANCEURL:c.default.get("prodInstanceURL"),GTMVERSION:c.default.get("gtmVersion"),CURRENT_INSTANCE:c.default.get("currentInstance"),IS_CLIENT:c.default.get("isClient"),SCHEMA_URI:c.default.get("schemaURI"),CLIENT_TOKEN:c.default.get("clientToken"),SUBSCIPTION:u(c.default.get("subsciption"))},exports.getFileData=(async e=>await p(e,"UTF-8")),exports.capitalize=(e=>e.toLowerCase().replace(/\b./g,function(e){return e.toUpperCase()})),exports.getXMlVersion=(e=>{const t=e.match(/xmlns="(.*?)"/),n=e.match(/otm="(.*?)"/),a=e.match(/gtm="(.*?)"/);if(!t)return{gtmVersion:null,xmlNsOtm:null,xmlNsGtm:null};const i=t[1].split("v");return{gtmVersion:+i[i.length-1],xmlNsOtm:n[1],xmlNsGtm:a[1]}}),exports.NAME={release:{Source_Location_Domain_Name:"Source Location DomainName",Source_Location_ID:"Source Location ID",Destination_Location_Domain_Name:"Destination Location DomainName",Destination_Location_ID:"Destination Location ID",Order_Configuration:"Order Configuration",Line_Item_Domain_Name:"Line Item DomainName",Line_Item_ID:"Line Item ID"},location:{AddressLine:"Address Line",AddressLineSequenceNumber:"Address Line Sequence Number"},party:{Location_ID_Domain_Name:"Location ID DomainName",Location_ID:"Location ID",Location_Transaction_Code:"Location TransactionCode",Country_Code_3_ID:"Country Code 3 ID",AddressLine:"Address Line",AddressLineSequenceNumber:"Address Line Sequence Number"},transaction:{Gtm_Transaction_ID_Domain_Name:"Transaction ID DomainName",Gtm_Transaction_ID:"Transaction ID",Gtm_Transaction_Line_ID_Domain_Name:"Line ID DomainName",Gtm_Transaction_Line_ID:"Line ID"},bom:{},orderBase:{Source_Location_Domain_Name:"Source Location DomainName",Source_Location_ID:"Source Location ID",Destination_Location_Domain_Name:"Destination Location DomainName",Destination_Location_ID:"Destination Location ID",Order_Configuration:"Order Configuration",Line_Item_Domain_Name:"Line Item DomainName",Line_Item_ID:"Line Item ID",Early_Pickup_Dt:"EarlyPickup Date",Early_Pickup_TZID:"EarlyPickup TimeZone",Early_Pickup_TZOffset:"EarlyPickup TimeZoneOffset",Late_Pickup_Dt:"LatePickup Date",Late_Pickup_TZID:"LatePickup TimeZone",Late_Pickup_TZOffset:"LatePickup TimeZoneOffset",Early_Delivery_Dt:"EarlyDelivery Date",Early_Delivery_TZID:"EarlyDelivery TimeZone",Early_Delivery_TZOffset:"EarlyDelivery TimeZoneOffset",Late_Delivery_Dt:"LateDelivery Date",Late_Delivery_TZID:"LateDelivery TimeZone",Late_Delivery_TZOffset:"LateDelivery TimeZoneOffset",Order_Base_Line_Packaged_Item_Count:"Line PackagedItem Count"},trackingEvent:{Shipment_ID:"Shipment ID"},shipment:{Equipment_Group_ID_DomainName:"Equipment Group ID DomainName",Equipment_Group_ID:"Equipment Group ID",Equipment_ID_DomainName:"Equipment ID DomainName",Equipment_ID:"Equipment ID",StartDt:"Start Date",EndDt:"End Date",ArrivalTime:"Arrival Time"}},exports.asyncHandler=(async e=>{const t={data:"",error:""};try{const{data:a}=await e;t.data=a}catch(n){t.error=n.error}return t.data||t.error||(t.error="Unauthorized User!"),t}),exports.generateAuthToken=function(e){return l.default.sign(t({},e),exports.CONSTS.JWT_PRIVATE_KEY,{expiresIn:"12h"})},exports.getReportUrl=(e=>`/GC3/glog.webserver.transmission.ITransactionDetailServlet/1556964221938?ct=NzU0OTQ3NTc2Nzg3NTk4MjE5Mw%3D%3D&id=${e}&is_new_window=true`),exports.getViewUrl=(()=>"/GC3/glog.webserver.finder.WindowOpenFramesetServlet/1563245261188?ct=MTc2NDM0MTg3ODk1NjM1MjU0MQ%3D%3D&bcKey=MTU2MzI0MzAwOTU2NDoy&url=GTM_OTM_OBJECTCustManagement%3Fmanager_layout_gid%3DGTM_OTM_MANAGER_LAYOUT_GID%26management_action%3Dview%26finder_set_gid%3DGTM_OTM_FINDER_SET%26pk%3DGTM_OTM_OBJECT_GID"),exports.getSidebar=(e=>[{name:"Item",link:"item",icon:"shopping_cart",api:"items",display:!0},{name:"Party",link:"party",icon:"business",api:"party",display:!0},{name:"Location",link:"location",icon:"add_location",api:"location",display:!0},{name:"Transaction",link:"transaction",icon:"swap_horizontal_circle",api:"transactions",display:!0},{name:"Order Base",link:"order-base",icon:"store",api:"order-base",display:!0},{name:"Order Release",link:"order-release",icon:"airport_shuttle",api:"order-release",display:!0},{name:"Bom",link:"bom",icon:"ballot",api:"bom",display:!0},{name:"Shipment",link:"shipment",icon:"directions_boat",api:"shipment",display:!0},{name:"Tracking Event",link:"tracking-event",icon:"gps_fixed",api:"tracking-event",display:!0},{name:"Audit",link:"admin/audit",icon:"history",api:"audit",display:e},{name:"Settings",link:"admin/settings",icon:"settings",api:"settings",display:e}]),exports.convertPath=((e,t)=>{const n={newPath:e,newName:e},a=new RegExp(`${t}.`+"[0-9]."),i=e.match(a);return i?(n.newPath=e.replace(i[0],`${t}.INDEX.`),n.newName=e.replace(i[0],`${t}.`)):n.newPath=e.replace(`${t}.`,`${t}.INDEX.`),n.newPath.match(/\.[0-9]\./)?(n.newPath=D(n.newPath,/\.[0-9]\./,".INDEX."),n.newName=n.newPath.replace(/INDEX\./g,""),n):n}),exports.asyncRouteHandler=(e=>(t,n,a)=>{Promise.resolve(e(t,n,a)).catch(a)}),exports.getDomainName=((e,t)=>e.split(".")[1]?{path:`${t}`,value:e.split(".")[0]}:{path:t,value:"PUBLIC"}),exports.getXID=((e,t)=>e.split(".")[1]?{path:`${t}`,value:e.split(".")[1]}:{path:`${t}`,value:e}),exports.getSequence=((e,t,n)=>({path:`${t}`,value:n+1})),exports.getTC=((e,t)=>({path:`${t}`,value:"IU"}));
},{}],"JZWk":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.decrypt=exports.encrypt=void 0;const t=require("./other"),r=e(require("simple-crypto-js")),p=t.CONSTS.JWT_PRIVATE_KEY;exports.encrypt=(e=>{return new r.default(p).encrypt(e)}),exports.decrypt=(e=>{return new r.default(p).decrypt(e)});
},{"./other":"irtd"}],"KJs0":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.wmServlet=exports.dbXml=void 0;const t=e(require("axios"));exports.dbXml=((e,r,o,s)=>{const l=e+"/GC3/glog.integration.servlet.DBXMLServlet?command=xmlExport";return t.default.post(l,r,{headers:{"Content-Type":"text/xml"},auth:{username:o,password:s}})}),exports.wmServlet=((e,r,o,s)=>{const l=e+"/GC3/glog.integration.servlet.WMServlet";return t.default.post(l,r,{headers:{"Content-Type":"text/xml"},auth:{username:o,password:s}})});
},{}],"ijEX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.authDengineUser=void 0;const R=require("../api/gtm");exports.authDengineUser=(async({url:e,username:_,password:E})=>{const L=`<sql2xml><Query><RootName>GL_USER_ACR_ROLE</RootName><Statement>${`SELECT NVL((SELECT NVL((SELECT (select ACR_ROLE_GID from GL_USER_ACR_ROLE  WHERE GL_USER_GID = '${_}' AND ACR_ROLE_GID LIKE '%GTM - DATA_UPLOAD_ADMIN' AND ROWNUM=1) GTM_CURRENT_USER_ACL FROM DUAL),(SELECT (select ACR_ROLE_GID from GL_USER_ACR_ROLE  WHERE GL_USER_GID = '${_}' AND ACR_ROLE_GID LIKE '%GTM - DATA_UPLOAD_USER' AND ROWNUM=1)  FROM DUAL))  FROM DUAL ),'NOT_AUTHORISED') GTM_CURRENT_USER_ACL FROM DUAL`}</Statement></Query></sql2xml>`;return R.dbXml(e,L,_,E)});
},{"../api/gtm":"KJs0"}],"hXw8":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("joi")),t=require("./../helper/other"),s=require("./../helper/encrypt"),n=e(require("express")),a=require("../helper/gtmAuth"),u=n.default.Router();function i(e){const t={username:r.default.string().min(1).max(30).required(),password:r.default.string().min(1).max(255).required()};return r.default.validate(e,t)}u.post("/",t.asyncRouteHandler(async(e,r)=>{const{error:n}=i(e.body);if(n)return r.status(400).send(n.details[0].message);let{username:u,password:d,instance:c}=e.body;c||(c=t.CONSTS.CURRENT_INSTANCE);const l={username:u,password:d,url:o(c)},{data:S,error:m}=await t.asyncHandler(a.authDengineUser(l));if(S.includes("Unauthorized"))return r.status(403).send("Sorry, you don't have access!");if(m)return r.status(500).send(m);if(S.toString().includes("error"))return r.status(500).send(S.match("<error>(.*)</error>")[1]);const p=S.match('GTM - DATA_UPLOAD_(.*)"')[1].trim();if("ADMIN"!==p&&"USER"!==p)return r.status(403).send("Sorry, you don't have access!");const N="ADMIN"===p,f=s.encrypt(d),T=t.getSidebar(N).filter(e=>t.CONSTS.SUBSCIPTION.includes(e.name.trim().toLowerCase().replace(" ","-"))),h=u.split(".")[0],y=t.generateAuthToken({username:u,domain:h,isAdmin:N,crypto:f,instance:c,sidebar:T});return r.send({data:y})}));const o=e=>"dev"===e?t.CONSTS.DEV_INSTANCEURL:"test"===e?t.CONSTS.TEST_INSTANCEURL:"prod"===e?t.CONSTS.PROD_INSTANCEURL:void 0;exports.default=u;
},{"./../helper/other":"irtd","./../helper/encrypt":"JZWk","../helper/gtmAuth":"ijEX"}],"MNoc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("jsonwebtoken")),r=require("../helper/other"),s=require("../helper/encrypt");async function n(e,n,u){const c=e.header("x-auth-token");if(!c)return n.status(401).send("Access denied. No token provided.");const d=e.baseUrl.split("/");if(!r.CONSTS.SUBSCIPTION.includes(d[d.length-1]))return n.status(401).send("Sorry, you don't have access.");try{const d=t.default.verify(c,r.CONSTS.JWT_PRIVATE_KEY);e.user=d,e.user.url=o(d),e.user.crypto&&(e.user.password=s.decrypt(d.crypto).toString()),u()}catch(i){n.status(400).send("Invalid token.")}}exports.default=n;const o=e=>{const{instance:t}=e;return"test"===t?r.CONSTS.TEST_INSTANCEURL:"prod"===t?r.CONSTS.PROD_INSTANCEURL:r.CONSTS.DEV_INSTANCEURL};
},{"../helper/other":"irtd","../helper/encrypt":"JZWk"}],"zMRv":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("../middleware/auth")),t=e(require("express")),s=require("../helper/other"),a=t.default.Router();a.get("/me",[r.default],s.asyncRouteHandler(async(e,r)=>{const{username:t,isAdmin:s,instance:a,sidebar:u}=e.user,i=t.split(".")[0];return r.send({data:{username:t,domain:i,isAdmin:s,instance:a,sidebar:u}})})),exports.default=a;
},{"../middleware/auth":"MNoc","../helper/other":"irtd"}],"bJb7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAutoGenId=exports.getCountryCodeFromGtm=exports.getIncotermFromGtm=exports.validateItemAndContact=exports.getTransmissionStatus=exports.getShipmentPropsfromGtm=exports.getTrackingEventPropfromOtm=exports.getOrderBasePropsfromGtm=exports.getPartyPropfromGtm=exports.getTransactionPropsfromGtm=exports.getBomPropsfromGtm=exports.getLocationPropfromOtm=exports.getReleasePropsfromGtm=exports.getItemPropfromGtm=void 0,exports.getItemPropfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(ITEM_REFNUM_QUAL_GID,',') within group (order by ITEM_REFNUM_QUAL_GID) FROM ITEM_REFNUM_QUAL) REFNUMS, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) ITEMFEATURES, (SELECT listagg(GTM_PROD_CLASS_TYPE_GID,',') within group (order by GTM_PROD_CLASS_TYPE_GID) FROM GTM_PROD_CLASS_TYPE) GTMITEMCLASSIFICATIONS, (SELECT listagg(GTM_LANGUAGE_GID ||'::'|| LANGUAGE_NAME,',') within group (order by GTM_LANGUAGE_GID ||'::'|| LANGUAGE_NAME) FROM GTM_LANGUAGE ) GTMITEMDESCRIPTIONS from dual\n</Statement></Query></sql2xml>",exports.getReleasePropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(ORDER_RELEASE_REFNUM_QUAL_GID,',') within group (order by ORDER_RELEASE_REFNUM_QUAL_GID) FROM ORDER_RELEASE_REFNUM_QUAL) RELEASE_REFNUMS, (SELECT listagg(OR_LINE_REFNUM_QUAL_GID,',') within group (order by OR_LINE_REFNUM_QUAL_GID) FROM ORDER_RELEASE_LINE_REFNUM_QUAL) RELEASE_lINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) lINE_ITEM_ATTRIBUTE from dual\n</Statement></Query></sql2xml>",exports.getLocationPropfromOtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(LOCATION_REFNUM_QUAL_GID,',') within group (order by LOCATION_REFNUM_QUAL_GID) FROM LOCATION_REFNUM_QUAL) REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getBomPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(GTM_STRUCTURE_REFNUM_QUAL_GID,',') within group (order by GTM_STRUCTURE_REFNUM_QUAL_GID) FROM GTM_STRUCTURE_REFNUM_QUAL) REFNUMS, (SELECT listagg(GTM_STR_COMP_REFNUM_QUAL_GID,',') within group (order by GTM_STR_COMP_REFNUM_QUAL_GID) FROM GTM_STR_COMPONENT_REFNUM_QUAL) COMPONENT_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY from dual\n</Statement></Query></sql2xml>",exports.getTransactionPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (select listagg(DATE_QUALIFIER_GID, ',') within group (order by DATE_QUALIFIER_GID) from (select DATE_QUALIFIER_GID, sum(length(DATE_QUALIFIER_GID) + 2) over (order by DATE_QUALIFIER_GID) running_length from GTM_DATE_QUALIFIER) where running_length &lt; 4000) DATES, (select listagg(GTM_QUANTITY_TYPE_GID ||'['||TYPE||']' , ',') within group (order by GTM_QUANTITY_TYPE_GID) from GTM_QUANTITY_TYPE) QUANTITY,(select listagg(GTM_VALUE_QUALIFIER_GID, ',') within group (order by GTM_VALUE_QUALIFIER_GID) from (select GTM_VALUE_QUALIFIER_GID, sum(length(GTM_VALUE_QUALIFIER_GID) + 2) over (order by GTM_VALUE_QUALIFIER_GID) running_length from GTM_VALUE_QUALIFIER) where running_length &lt; 4000) CURRENCY,(SELECT listagg(GTM_TRANS_REFNUM_QUAL_GID,',') within group (order by GTM_TRANS_REFNUM_QUAL_GID) FROM GTM_TRANS_REFNUM_QUAL) GTMTRANS_REFNUMS, (SELECT listagg(GTM_TRANSLINE_REFNUM_QUAL_GID,',') within group (order by GTM_TRANSLINE_REFNUM_QUAL_GID) FROM GTM_TRANSLINE_REFNUM_QUAL) GTMTRANSACTION_lINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY,(SELECT listagg(CURRENCY_GID,',') within group (order by CURRENCY_GID) FROM CURRENCY) CURRENCY_UOM,(SELECT listagg(UOM_CODE||'['||TYPE||']',',') within group (order by UOM_CODE) FROM UOM where UOM_CODE in (select distinct UOM_CODE from GTM_TRANSACTION_QUANTITY)) QUANTITY_UOM from dual\n</Statement></Query></sql2xml>",exports.getPartyPropfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000 and REMARK_QUAL_GID NOT LIKE 'HAZMAT%'and REMARK_QUAL_GID NOT LIKE 'ITEM_%' and REMARK_QUAL_GID NOT LIKE 'PARTY_%' and REMARK_QUAL_GID NOT LIKE 'BIIB.NET_WEIGHT%' and REMARK_QUAL_GID NOT LIKE 'BIIB.UOM%' and REMARK_QUAL_GID NOT LIKE 'BIIB.GROSS_WEIGHT%' and REMARK_QUAL_GID NOT LIKE 'BIIB.TOTAL_PACKAGING_UNIT_COUNT%') REMARKS, (SELECT listagg(GTM_PARTY_REFNUM_QUAL_GID,',') within group (order by GTM_PARTY_REFNUM_QUAL_GID) FROM GTM_PARTY_REFNUM_QUAL) CONTACT_REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getOrderBasePropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(OB_REFNUM_QUAL_GID,',') within group (order by OB_REFNUM_QUAL_GID) FROM OB_REFNUM_QUAL) ORDER_BASE_REFNUMS, (SELECT listagg(OB_LINE_REFNUM_QUAL_GID,',') within group (order by OB_LINE_REFNUM_QUAL_GID) FROM OB_LINE_REFNUM_QUAL) OB_LINE_REFNUMS, (SELECT listagg(INVOLVED_PARTY_QUAL_GID,',') within group (order by INVOLVED_PARTY_QUAL_GID) FROM INVOLVED_PARTY_QUAL) INVOLVED_PARTY, (SELECT listagg(ITEM_FEATURE_QUAL_GID,',') within group (order by ITEM_FEATURE_QUAL_GID) FROM ITEM_FEATURE_QUAL) lINE_ITEM_ATTRIBUTE from dual\n</Statement></Query></sql2xml>",exports.getTrackingEventPropfromOtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(SELECT listagg(SHIPMENT_REFNUM_QUAL_GID,',') within group (order by SHIPMENT_REFNUM_QUAL_GID) FROM SHIPMENT_REFNUM_QUAL) REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getShipmentPropsfromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nselect(select listagg(REMARK_QUAL_GID, ',') within group (order by REMARK_QUAL_GID) from (select REMARK_QUAL_GID, sum(length(REMARK_QUAL_GID) + 2) over (order by REMARK_QUAL_GID) running_length from REMARK_QUAL) where running_length &lt; 4000) REMARKS, (SELECT listagg(SHIPMENT_REFNUM_QUAL_GID,',') within group (order by SHIPMENT_REFNUM_QUAL_GID) FROM SHIPMENT_REFNUM_QUAL) SHIPMENT_REFNUMS from dual\n</Statement></Query></sql2xml>",exports.getTransmissionStatus=((_,t)=>`<sql2xml>  \n  <Query>  \n  <RootName>  \n  TRANSACTION_STATUS  \n  </RootName>  \n  <Statement>\n  \n  select OBJECT_GID\n  ,DATA_QUERY_TYPE_GID  \n  ,I_TRANSACTION_NO  \n  ,STATUS\n  \n   from i_transaction\n  \n  where ('magic',${t?"I_TRANSACTION_NO":"I_TRANSMISSION_NO"})\n  \n  in ( ('magic','${_.join("'),('magic','")}' ))\n  \n  </Statement>  \n  </Query>  \n</sql2xml>`),exports.validateItemAndContact=(({items:_,contacts:t})=>`<sql2xml><Query><RootName>GTM</RootName><Statement>\n  SELECT (\n    SELECT LISTAGG(contact_gid, ',') WITHIN\n    GROUP (\n        ORDER BY contact_gid\n        )\n    FROM contact\n    WHERE contact_gid IN ('${t.join("','")}')\n    ) PARTY\n  ,(\n    SELECT LISTAGG(ITEM_GID, ',') WITHIN\n    GROUP (\n        ORDER BY ITEM_GID\n        )\n    FROM ITEM\n    WHERE ITEM_GID IN ('${_.join("','")}')\n    ) ITEM\n  FROM dual\n  </Statement></Query></sql2xml>`),exports.getIncotermFromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nSELECT distinct INCO_TERM_GID as INCOTERM FROM INCO_TERM\n</Statement></Query></sql2xml>",exports.getCountryCodeFromGtm="<sql2xml><Query><RootName>GTM</RootName><Statement>\nSELECT distinct COUNTRY_CODE3_XID || ' - ' || COUNTRY_NAME COUNTRY \nFROM COUNTRY_CODE\n</Statement></Query></sql2xml>",exports.getAutoGenId="<sql2xml><Query><RootName>GTM</RootName><Statement>\nSELECT nvl((\n  SELECT MAX(ITEM_REFNUM_VALUE)\n  FROM ITEM_REFNUM\n  WHERE ITEM_REFNUM_QUAL_GID = 'BIIB.ITEM_NUMBER'\n    AND ITEM_REFNUM_VALUE LIKE 'GTM%'\n  ), 'GTM00000') ITEM\n,NVL((\n  SELECT MAX(contact_xid)\n  FROM contact\n  WHERE contact_Gid LIKE 'BIIB.GTMPARTY-%'\n  ), 'GTMPARTY' || '00000000') CONTACT\n,NVL((\n  SELECT max(GTM_TRANSACTION_xID)\n  FROM GTM_TRANSACTION\n  WHERE GTM_TRANSACTION_GID LIKE 'BIIB.U' || to_char(sysdate, 'yyyymmdd') || '-%'\n  ), ('U' || to_char(sysdate, 'yyyymmdd')) || '-00000000') TRX\nFROM DUAL\n</Statement></Query></sql2xml>";
},{}],"C6I7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Report=void 0;const t=e(require("mongoose")),r=new t.default.Schema({item:{type:"Number",default:0},party:{type:"Number",default:0},location:{type:"Number",default:0},"order-release":{type:"Number",default:0},"order-base":{type:"Number",default:0},bom:{type:"Number",default:0},transaction:{type:"Number",default:0},"tracking-event":{type:"Number",default:0},shipment:{type:"Number",default:0},user:{type:"String",required:!0},insertDate:{type:Date,default:Date.now}});exports.Report=(e=>t.default.model("Report",r,`Report_${e}`));
},{}],"IMRL":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validate=exports.Setting=void 0;const t=e(require("joi")),r=e(require("mongoose")),u=new r.default.Schema({url:{type:"String"},version:{type:"Number"},glogPerTrx:{type:"Number",default:10},item:{type:"Number",default:0},party:{type:"Number",default:0},location:{type:"Number",default:0},"order-release":{type:"Number",default:0},"order-base":{type:"Number",default:0},bom:{type:"Number",default:0},transaction:{type:"Number",default:0},"tracking-event":{type:"Number",default:0},shipment:{type:"Number",default:0}});function a(e){const r={glogPerTrx:{type:Number,required:!0}};return t.default.validate(e,r)}const o=e=>r.default.model("Setting",u,`Setting_${e}`);exports.Setting=o,exports.validate=a;
},{}],"z2rt":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Item=void 0;const t=e(require("mongoose")),o=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Item=((e,r)=>t.default.model("Item",o,`${e}_Item_${r}`));
},{}],"iDDx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaItem=void 0;const t=e(require("mongoose")),m=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ItemMaster:{type:"Mixed"}});exports.SchemaItem=t.default.model("SchemaItem",m,"ItemSchema");
},{}],"jN2X":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDefaultValue=exports.getMandatoryElement=exports.getElementName=void 0;const e=require("./other");exports.getElementName=(e=>{const r=e.replace(/(otm:|otm|gtm:|gtm)/gi,""),i=r.lastIndexOf("Gid"),n=r.substring(0,i-1).lastIndexOf(".")+1,o=r.substring(n,i-1),s=r.substring(r.lastIndexOf(".")+1),c=r.lastIndexOf("TransactionCode"),m=r.substring(0,c-1).lastIndexOf(".")+1,d=r.lastIndexOf("GtmItemCountryOfOrigin"),l=r.substring(0,d-1).lastIndexOf(".")+1,D=r.lastIndexOf("SequenceNumber"),L=r.substring(0,D-1).lastIndexOf(".")+1,h=r.lastIndexOf("Description"),u=r.substring(0,h-1).lastIndexOf(".")+1;let _=r.search("Xid")>-1?o:s;switch(_=_.replace(/(otm:|otm|gtm:|gtm)/gi,"").trim(),!0){case"DomainName"===_:_=r.substring(n,i-1)+_;break;case"TransactionCode"===_:_=r.substring(m,c-1).replace(/Header/g,"")+_;break;case"GtmItemCountryOfOrigin"===_:_="Suppliers"+r.substring(l,d-1)+_;break;case"SequenceNumber"===_:_=r.substring(L,D-1)+_;break;case"Description"===_:_=r.substring(u,h-1)+_;break;default:_=_.trim()}const p=(_=_.replace(/(otm:|otm|gtm:|gtm)/gi,"").trim()).match(/[A-Z][a-z]+|[0-9]+/g);return _=t(_=p&&p.length>1?p.join(" ").replace("Gid","ID"):_),a(_,e)}),exports.getMandatoryElement=((e,a=[])=>a.findIndex(a=>a===e)>-1),exports.getDefaultValue=((e,a)=>e.search("TransactionCode")>-1?"IU":e.search("DomainName")>-1?a:"");const a=(a,t)=>t.match(/GtmStructureComponent/)?`Bom Component ${a.replace(/(GtmStructure(.*?)Component)/gi,"").trim()}`:t.match(/GtmStructure(.*?)/)?a.replace(/(Structure)/g,"Bom").trim():t.match(/GtmContact(.*?)AddressLines(.*?)SequenceNumber/)?e.NAME.party.AddressLineSequenceNumber:t.match(/GtmContact(.*?)AddressLines(.*?)AddressLine/)?e.NAME.party.AddressLine:t.match(/Location(.*?)AddressLines(.*?)SequenceNumber/)?e.NAME.location.AddressLineSequenceNumber:t.match(/Location(.*?)AddressLines(.*?)AddressLine/)?e.NAME.location.AddressLine:t.match(/Release(.*?)ShipFromLocationRef(.*?)DomainName/)?e.NAME.release.Source_Location_Domain_Name:t.match(/Release(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.release.Source_Location_ID:t.match(/Release(.*?)ShipToLocationRef(.*?)DomainName/)?e.NAME.release.Destination_Location_Domain_Name:t.match(/Release(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.release.Source_Location_ID:t.match(/Release(.*?)ShipToLocationRef(.*?)Xid/)?e.NAME.release.Destination_Location_ID:t.match(/Release(.*?)ReleaseMethodGid(.*?)Xid/)?e.NAME.release.Order_Configuration:t.match(/Release(.*?)InitialItemGid(.*?)DomainName/)?e.NAME.release.Line_Item_Domain_Name:t.match(/Release(.*?)InitialItemGid(.*?)Xid/)?e.NAME.release.Line_Item_ID:t.match(/Release(.*?)ReleaseLine/)?`Line ${a.replace(/Release(.*?)Line/,"").trim()}`:t.match(/EarlyPickupDt(.*?)GLogDate/)?e.NAME.orderBase.Early_Pickup_Dt:t.match(/EarlyPickupDt(.*?)TZId/)?e.NAME.orderBase.Early_Pickup_TZID:t.match(/EarlyPickupDt(.*?)TZOffset/)?e.NAME.orderBase.Early_Pickup_TZOffset:t.match(/LatePickupDt(.*?)GLogDate/)?e.NAME.orderBase.Late_Pickup_Dt:t.match(/LatePickupDt(.*?)TZId/)?e.NAME.orderBase.Late_Pickup_TZID:t.match(/LatePickupDt(.*?)TZOffset/)?e.NAME.orderBase.Late_Pickup_TZOffset:t.match(/LateDeliveryDt(.*?)GLogDate/)?e.NAME.orderBase.Late_Delivery_Dt:t.match(/LateDeliveryDt(.*?)TZId/)?e.NAME.orderBase.Late_Delivery_TZID:t.match(/LateDeliveryDt(.*?)TZOffset/)?e.NAME.orderBase.Late_Delivery_TZOffset:t.match(/EarlyDeliveryDt(.*?)GLogDate/)?e.NAME.orderBase.Early_Delivery_Dt:t.match(/EarlyDeliveryDt(.*?)TZId/)?e.NAME.orderBase.Early_Delivery_TZID:t.match(/EarlyDeliveryDt(.*?)TZOffset/)?e.NAME.orderBase.Early_Delivery_TZOffset:t.match(/StartDt(.*?)GLogDate/)?e.NAME.shipment.StartDt:t.match(/EndDt(.*?)GLogDate/)?e.NAME.shipment.EndDt:t.match(/ArrivalTime(.*?)GLogDate/)?e.NAME.shipment.ArrivalTime:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)DomainName/)?e.NAME.orderBase.Source_Location_Domain_Name:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.orderBase.Source_Location_ID:t.match(/TransOrder(.*?)ShipToLocationRef(.*?)DomainName/)?e.NAME.orderBase.Destination_Location_Domain_Name:t.match(/TransOrder(.*?)ShipFromLocationRef(.*?)Xid/)?e.NAME.orderBase.Source_Location_ID:t.match(/TransOrder(.*?)ShipToLocationRef(.*?)Xid/)?e.NAME.orderBase.Destination_Location_ID:t.match(/TransOrder(.*?)ReleaseMethodGid(.*?)Xid/)?e.NAME.orderBase.Order_Configuration:t.match(/TransOrder(.*?)InitialItemGid(.*?)DomainName/)?e.NAME.orderBase.Line_Item_Domain_Name:t.match(/TransOrder(.*?)InitialItemGid(.*?)Xid/)?e.NAME.orderBase.Line_Item_ID:t.match(/TransOrderLine/)?`Line ${a.replace(/(Trans(.*?)Order(.*?)Line|Order(.*?)Line)/g,"").trim()}`:t.match(/TransOrder(.*?)TransOrderHeader/)?a.replace(/Trans(.*?)Order/g,"OrderBase").trim():t.match(/GtmTransactionLine/)?`Line ${a.replace(/(Transaction(.*?)Line)/gi,"").trim()}`:t.match(/GtmTransaction(.*?)/)?a.replace(/(Transaction)/g,"Transaction").trim():t.match(/LocationRefGid(.*?)DomainName/)?e.NAME.location.Location_ID_Domain_Name:t.match(/LocationRefGid(.*?)Xid/)?e.NAME.location.Location_ID:t.match(/LocationRefGid\.(.*?)/)&&!a.includes("LocationRef")?`Location ${a.trim()}`:t.match(/Contact(.*?)/)?a.replace(/(Party|Contact)/gi,"Party").trim():a;function t(e){return e.replace("Transaction Code","TransactionCode").replace("Domain Name","DomainName").replace("Service Provider","ServiceProvider").replace("User Defined","UserDefined").replace("Ship Unit","ShipUnit").replace("Packaged Item","PackagedItem")}
},{"./other":"irtd"}],"OaWk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapItemDescription=exports.mapRemark=exports.mapItemClassification=exports.mapItemFeature=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=["Item TransactionCode","Item ID DomainName","Item ID"],p=(a,t,p)=>{const r=e.capitalize(p.split("_").join(" "));return r.split(".")[1]?r.split(".")[1]:r},r=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let i=0;i<e.getSequence.length;i++){e.getSequence[i]}exports.mapHeader=((e,p,r,i,l)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),isMandatory:a.getMandatoryElement(e.name,t),type:p,displayText:e.name,defaultValue:a.getDefaultValue(e.path,l),path:[e.path],gtmVersion:r,xmlNs:i})),exports.mapRefnum=((t,i,l,n,s,m,o)=>{const u=r(i,"Xid"),d=r(i,"DomainName"),c=r(i,"RefnumValue"),h=r(i,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:p(0,0,t),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path.replace("INDEX",m),value:""},e.getDomainName(t,i[d].path.replace("INDEX",m)),e.getTC(t,i[h].path.replace("INDEX",m)),e.getXID(t,i[u].path.replace("INDEX",m))],gtmVersion:n,xmlNs:s}}),exports.mapItemFeature=((t,i,l,n,s,m,o)=>{const u=r(i,"Xid"),d=r(i,"DomainName"),c=r(i,"ItemFeatureValue"),h=r(i,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:p(0,0,t),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path,value:""},e.getDomainName(t,i[d].path),e.getTC(t,i[h].path),e.getXID(t,i[u].path)],gtmVersion:n,xmlNs:s}}),exports.mapItemClassification=((t,p,i,l,n,s,m)=>{const o=r(p,"Xid"),u=r(p,"ClassificationCode"),d=r(p,"TransactionCode");return{name:`${t}`,required:!0,disabled:!1,display:!1,type:i,displayText:`${t}`,defaultValue:a.getDefaultValue(p[u].path,m),path:[{path:p[u].path.replace("INDEX",s),value:""},e.getTC(t,p[d].path.replace("INDEX",s)),e.getXID(t,p[o].path.replace("INDEX",s))],gtmVersion:l,xmlNs:n}}),exports.mapRemark=((t,i,l,n,s,m,o)=>{const u=r(i,"Xid"),d=r(i,"DomainName"),c=r(i,"RemarkText"),h=r(i,"RemarkSequence"),D=r(i,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:p(0,0,t),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path.replace("INDEX",m),value:""},e.getTC(t,i[D].path.replace("INDEX",m)),e.getSequence(t,i[h].path.replace("INDEX",m),m),e.getDomainName(t,i[d].path.replace("INDEX",m)),e.getXID(t,i[u].path.replace("INDEX",m))],gtmVersion:n,xmlNs:s}}),exports.mapItemDescription=((t,p,i,l,n,s,m)=>{const o=r(p,"Xid"),u=r(p,"DomainName"),d=r(p,":Description"),c=r(p,"SequenceNumber"),h=r(p,"TransactionCode");return{name:`Description in ${t.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:i,displayText:`Description in ${t.split("::")[1]}`,defaultValue:a.getDefaultValue(p[d].path,m),path:[{path:p[d].path,value:""},e.getTC(t.split("::")[0],p[h].path),e.getSequence(t.split("::")[0],p[c].path,s),e.getDomainName(t.split("::")[0],p[u].path),e.getXID(t.split("::")[0],p[o].path)],gtmVersion:l,xmlNs:n}});
},{"../other":"irtd","../renamer":"jN2X"}],"UQUS":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCountryFromGtm=exports.getUpdatedProp=exports.getItemData=exports.getItemSchema=exports.validateItemAndContactFromGtm=exports._getCountryFromGtm=void 0;const e=t(require("lodash")),n=t(require("promise-memoize")),r=require("../../models/item"),a=require("../../models/schemaItem"),m=require("./itemProps"),i=require("../other"),o=require("../dbXmlQuery"),s=require("../../api/gtm");function c(t,n,r,a){return new Promise(function(m){let{Header:i,Remark:o,Refnum:s,GtmItemClassification:c,GtmItemDescription:d,ItemFeature:l}=t.ItemMaster.Item;const y=t.xmlNs;i=x(i,n,y,a),o=g(r,o,n,y,a),s=h(r,s,n,y,a),l=I(r,l,n,y,a),c=p(r,c,n,y,a),d=f(r,d,n,y,a),m(e.default.uniqBy([...i,...o,...s,...l,...c,...d],u()))})}function u(){return t=>t.name}function f(t,e,n,r,a){return e=t.match(/GTMITEMDESCRIPTIONS="(.*?)"/)[1].split(",").map(d(e,n,r,a))}function p(t,e,n,r,a){return e=t.match(/GTMITEMCLASSIFICATIONS="(.*?)"/)[1].split(",").map(l(e,n,r,a))}function d(t,e,n,r){return(a,i)=>m.mapItemDescription(a,t,"Item : Description",e,n,i,r)}function l(t,e,n,r){return(a,i)=>m.mapItemClassification(a,t,"Item : Classification",e,n,i,r)}function I(t,e,n,r,a){const i=t.match(/ITEMFEATURES="(.*?)"/)[1].split(",");return e=i.map((t,i)=>m.mapItemFeature(t,e,"Item : Feature",n,r,i,a))}function h(t,e,n,r,a){const i=t.match(/REFNUMS="(.*?)"/)[1].split(",");return e=i.map((t,i)=>m.mapRefnum(t,e,"Item : Refnum",n,r,i,a))}function g(t,e,n,r,a){const i=t.match(/REMARKS="(.*?)"/)[1].split(",");return e=i.map((t,i)=>m.mapRemark(t,e,"Item : Remark",n,r,i,a))}function x(t,e,n,r){return t=t.map(t=>m.mapHeader(t,"Item : Header",e,n,r))}function y(t,n,a,m){return new Promise(async function(i){const o=e.default.differenceWith(t,n,(t,e)=>t.name===e.name),s=e.default.differenceWith(n,t,(t,e)=>t.name===e.name);if(o.length>0){const t=await r.Item(m,a).insertMany(o);i([...n,...t])}else s.length>0?(await r.Item(m,a).deleteMany({_id:{$in:[...s.map(t=>t._id)]}}),i(e.default.differenceWith(n,s,(t,e)=>t.name===e.name))):i(n)})}function C(t){return a.SchemaItem.findOne({gtmVersion:t}).sort({_id:1})}async function F(t,e,n){const{data:r}=await i.asyncHandler(s.dbXml(t,o.getCountryCodeFromGtm,e,n));return M(r)}function M(t){const e=/COUNTRY="(.*?)"/g,n={};let r;for(;r=e.exec(t);){const t=r.pop().split(" - ");n[t[0]]=t[1]}return Object.keys(n).length>0?n:{}}async function R(t,e,n,r){const{data:a}=await i.asyncHandler(s.dbXml(t,o.validateItemAndContact(r),e,n));return A(a)}function A(t){const e={items:{},contacts:{}},n=/PARTY="(.*?)"/,r=/ITEM="(.*?)"/;if(t.match(n)){const r=t.match(n)[1];if(r.includes(",")){r.split(",").forEach(t=>{e.contacts[t]=1})}else e.contacts[r]=1}if(t.match(r)){const n=t.match(r)[1];if(n.includes(",")){n.split(",").forEach(t=>{e.items[t]=1})}else e.items[n]=1}return e}exports._getCountryFromGtm=F,exports.validateItemAndContactFromGtm=R,exports.getItemSchema=n.default(C,{maxAge:6e4}),exports.getItemData=n.default(c,{maxAge:6e4}),exports.getUpdatedProp=n.default(y,{maxAge:6e4}),exports.getCountryFromGtm=n.default(F);
},{"../../models/item":"z2rt","../../models/schemaItem":"iDDx","./itemProps":"OaWk","../other":"irtd","../dbXmlQuery":"bJb7","../../api/gtm":"KJs0"}],"oAdS":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=t(require("multiparty")),n=t(require("node-xlsx")),s=require("../helper/other"),r=require("../api/gtm"),i=require("../helper/dbXmlQuery"),o=require("../api/gtm"),u=t(require("./../middleware/auth")),c=require("../models/report"),d=require("../models/setting"),l=t(require("path")),m=require("../index"),p=require("../helper/Item/getItemData"),f=e.default.Router();function T(t){return t.match(/ReferenceTransmissionNo>(.*?)</)[1]}async function y(t,e,a){const n=Array.from(new Set(t)),r={$inc:{[e]:n.length}};await d.Setting(s.CONSTS.CURRENT_INSTANCE).findOneAndUpdate({version:+s.CONSTS.GTMVERSION},r,{new:!0}),await c.Report(s.CONSTS.CURRENT_INSTANCE).create({instance:s.CONSTS.CURRENT_INSTANCE,user:a,[e]:n.length})}function N(t,e,a,n,r,i,o){const u=t[e];a=u.match(/DATA_QUERY_TYPE_GID="(.*?)"/)[1].toLowerCase().replace("gtm","").replace("contact","party").trim().replace(" ","-");const c=u.match(/I_TRANSACTION_NO="(.*?)"/)[1],d=u.match(/OBJECT_GID="(.*?)"/)[1],l=u.match(/STATUS="(.*?)"/)[1];return n.push({xid:r?i[e]:d.includes(".")?d.split(".")[1]:d,transmission:c,status:l,instanceURL:o+s.getReportUrl(c),viewURL:o+s.getViewUrl()}),a}function R(t,e){return t=t.replace("<Transmission>",`<Transmission xmlns="${e[0]}" xmlns:otm="${e[0]}" xmlns:gtm="${e[1]}" >`)}async function g(t,e,a){const{data:n}=await s.asyncHandler(o.dbXml(t,i.getAutoGenId,e,a));return h(n)}function h(t){return{item:t.match(/ITEM="(.*?)"/)[1],contact:t.match(/CONTACT="(.*?)"/)[1],transaction:t.match(/TRX="(.*?)"/)[1]}}function w(t,e){const a=t.item.split(/(\d+)/),n=t.contact.split(/-/g),s=t.transaction.split(/-/g),r={str:a[0],counter:Number(a[1])},i=S(n,"",""),o=S(n,"","");return{item:r,contact:i,transaction:S(s,"",""),location:o,transactionLine:S(s,"","")}}function S(t,e,a){return 2===t.length?{str:t[0],counter:Number(t[1])}:{str:a,counter:0}}f.post("/",[u.default],s.asyncRouteHandler(async(t,e)=>{const{username:a,password:n,url:i}=t.user,{xml:o,xmlNs:u}=t.body;let c=o.toString();c=R(c,u);const{data:d,error:l}=await s.asyncHandler(r.wmServlet(i,c,a,n));if(l)return e.status(400).send(l);if(!d.includes("ReferenceTransmissionNo"))return e.status(400).send("Invalid csv Data");const m=T(d);return e.send({data:{ReferenceTransmissionNo:m}})})),f.post("/filedata",[u.default],s.asyncRouteHandler(async(t,e)=>{(new a.default.Form).parse(t,async function(t,a,s){const r=s[Object.keys(s)[0]][0].path,i=await n.default.parse(r,{raw:!0});return e.status(200).send({data:i[0].data})})})),f.post("/status",[u.default],s.asyncRouteHandler(async(t,e)=>{const{username:a,password:n,url:r}=t.user,{transmission:u,reProcess:c,xids:d,considerXid:l}=t.body;if(!u&&!u.length)return e.status(400).send("Bad request!");const m=i.getTransmissionStatus(u,c),{data:p,error:f}=await s.asyncHandler(o.dbXml(r,m,a,n));if(f)return e.status(400).send(f);const T=p.match(/<TRANSACTION_STATUS(.*?)>/g),R=[];let g="";for(let s=0;s<T.length;s++)g=N(T,s,g,R,l,d,r);return c||await y(d,g,a),e.send({data:R})})),f.get("/validate/static",[u.default],s.asyncRouteHandler(async(t,e)=>{const a=l.default.join(m.ROOT_DIR,"XMLs","static.json"),n=await s.getFileData(a);return e.status(200).json(JSON.parse(n))})),f.get("/validate/autogen",[u.default],s.asyncRouteHandler(async(t,e)=>{const{username:a,password:n,url:s}=t.user,r=await g(s,a,n),i=new Date;return e.status(200).json({data:w(r,i)})})),f.post("/validate/dynamic",[u.default],s.asyncRouteHandler(async(t,e)=>{const{username:a,password:n,url:s}=t.user,{items:r,contacts:i}=t.body;if(!r||!i)return e.status(400).send("Items or Contacts missing!");const o=await p.validateItemAndContactFromGtm(s,a,n,t.body);return e.status(200).json({data:o})})),exports.default=f;
},{"../helper/other":"irtd","../api/gtm":"KJs0","../helper/dbXmlQuery":"bJb7","./../middleware/auth":"MNoc","../models/report":"C6I7","../models/setting":"IMRL","../index":"Focm","../helper/Item/getItemData":"UQUS"}],"Yp05":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Release=void 0;const t=e(require("mongoose")),a=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Release=((e,o)=>t.default.model("Release",a,`${e}_Release_${o}`));
},{}],"Ys6U":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaRelease=void 0;const t=e(require("mongoose")),s=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Release:{type:"Mixed"}});exports.SchemaRelease=t.default.model("SchemaRelease",s,"OrderReleaseSchema");
},{}],"iG5u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapItemDescription=exports.mapInvolvedParty=exports.mapItemClassification=exports.mapItemFeature=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),p=["Release ID DomainName","Release ID","Release TransactionCode","Line ID DomainName","Line ID","Line TransactionCode",...Object.values(t.NAME.release)],i=(a,t,p)=>{const i=e.capitalize(p.split("_").join(" "));return i.split(".")[1]?i.split(".")[1]:i},r=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}exports.mapHeader=((e,t,i,r,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,p),display:a.getMandatoryElement(e.name,p),isMandatory:a.getMandatoryElement(e.name,p),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:i,xmlNs:r})),exports.mapRefnum=((t,p,n,l,s,m,o,d)=>{const u=r(p,"Xid"),h=r(p,"DomainName"),c=r(p,"RefnumValue"),D=r(p,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${i(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(p[c].path,d),path:[{path:p[c].path.replace("INDEX",m),value:""},e.getDomainName(t,p[h].path.replace("INDEX",m)),e.getTC(t,p[D].path.replace("INDEX",m)),e.getXID(t,p[u].path.replace("INDEX",m))],gtmVersion:l,xmlNs:s}}),exports.mapRemark=((t,p,n,l,s,m,o,d)=>{const u=r(p,"Xid"),h=r(p,"DomainName"),c=r(p,"RemarkText"),D=r(p,"RemarkSequence"),g=r(p,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${i(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(p[c].path,d),path:[{path:p[c].path.replace("INDEX",m),value:""},e.getTC(t,p[g].path.replace("INDEX",m)),e.getSequence(t,p[D].path.replace("INDEX",m),m),e.getDomainName(t,p[h].path.replace("INDEX",m)),e.getXID(t,p[u].path.replace("INDEX",m))],gtmVersion:l,xmlNs:s}}),exports.mapItemFeature=((t,p,n,l,s,m,o,d)=>{const u=r(p,"Xid"),h=r(p,"DomainName"),c=r(p,"ItemFeatureValue"),D=r(p,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${i(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(p[c].path,d),path:[{path:p[c].path,value:""},e.getDomainName(t,p[h].path),e.getTC(t,p[D].path),e.getXID(t,p[u].path)],gtmVersion:l,xmlNs:s}}),exports.mapItemClassification=((t,p,i,n,l,s,m)=>{const o=r(p,"Xid"),d=r(p,"ClassificationCode"),u=r(p,"TransactionCode");return{name:`${t}`,required:!0,disabled:!1,display:!1,type:i,displayText:`${t}`,defaultValue:a.getDefaultValue(p[d].path,m),path:[{path:p[d].path,value:""},e.getTC(t,p[u].path),e.getXID(t,p[o].path)],gtmVersion:n,xmlNs:l}}),exports.mapInvolvedParty=((t,p,n,l,s,m,o,d="")=>{const u=r(p,/InvolvedPartyQualifierGid(.*?)Xid/),h=r(p,/ContactGid(.*?)Xid/),c=r(p,/ContactGid(.*?)DomainName/),D=r(p,"TransactionCode");return{name:`${o} ${t} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${i(0,0,t)} Contact ID`.trim(),defaultValue:a.getDefaultValue(p[h].path,d),path:[{path:p[h].path,value:""},e.getTC(t,p[D].path),{path:p[c].path,value:d},e.getXID(t,p[u].path)],gtmVersion:l,xmlNs:s}}),exports.mapItemDescription=((t,p,i,n,l,s,m)=>{const o=r(p,"Xid"),d=r(p,"DomainName"),u=r(p,":Description"),h=r(p,"SequenceNumber"),c=r(p,"TransactionCode");return{name:`Description in ${t.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:i,displayText:`Description in ${t.split("::")[1]}`,defaultValue:a.getDefaultValue(p[u].path,m),path:[{path:p[u].path,value:""},e.getTC(t.split("::")[0],p[c].path),e.getSequence(t.split("::")[0],p[h].path,s),e.getDomainName(t.split("::")[0],p[d].path),e.getXID(t.split("::")[0],p[o].path)],gtmVersion:n,xmlNs:l}});
},{"../other":"irtd","../renamer":"jN2X"}],"NFyl":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getReleaseData=exports.getReleaseSchema=void 0;const a=e(require("lodash")),t=e(require("promise-memoize")),n=require("../../models/release"),r=require("../../models/schemaRelease"),s=require("./releaseProps");function m(e,t,n,r){return new Promise(function(m){let{Header:l,Remark:i,Refnum:o,InvolvedParty:d}=e.Release.Release,{Header:R,Remark:p,Refnum:u,InvolvedParty:f}=e.Release.ReleaseLine;const c=e.xmlNs;l=l.map(e=>s.mapHeader(e,"Release : Header",t,c,r)),R=R.map(e=>s.mapHeader(e,"Release Line : Header",t,c,r));const h=n.match(/REMARKS="(.*?)"/)[1].split(",");i=h.map((e,a)=>s.mapRemark(e,i,"Release : Remark",t,c,a,"",r)),p=h.map((e,a)=>s.mapRemark(e,p,"Release Line : Remark",t,c,a,"Line",r));const v=n.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");d=v.map((e,a)=>s.mapInvolvedParty(e,d,"Release : Involved Party",t,c,a,"",r)),f=v.map((e,a)=>s.mapInvolvedParty(e,f,"Release Line : Involved Party",t,c,a,"Line",r));const P=n.match(/RELEASE_REFNUMS="(.*?)"/)[1].split(",");o=P.map((e,a)=>s.mapRefnum(e,o,"Release : Refnum",t,c,a,"",r));const _=n.match(/RELEASE_LINE_REFNUMS="(.*?)"/)[1].split(",");u=_.map((e,a)=>s.mapRefnum(e,u,"Release Line : Refnum",t,c,a,"Line",r)),m(a.default.uniqBy([...l,...i,...o,...d,...R,...p,...u,...f],e=>e.name))})}function l(e,t,r,s){return new Promise(async function(m){const l=a.default.differenceWith(e,t,(e,a)=>e.name===a.name),i=a.default.differenceWith(t,e,(e,a)=>e.name===a.name);if(l.length>0){const e=await n.Release(s,r).insertMany(l);m([...t,...e])}else i.length>0?(await n.Release(s,r).deleteMany({_id:{$in:[...i.map(e=>e._id)]}}),m(a.default.differenceWith(t,i,(e,a)=>e.name===a.name))):m(t)})}function i(e){return r.SchemaRelease.findOne({gtmVersion:e}).sort({_id:1})}exports.getReleaseSchema=t.default(i,{maxAge:6e4}),exports.getReleaseData=t.default(m,{maxAge:6e4}),exports.getUpdatedProp=t.default(l,{maxAge:6e4});
},{"../../models/release":"Yp05","../../models/schemaRelease":"Ys6U","./releaseProps":"iG5u"}],"aCHs":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),s=require("../helper/other"),r=require("../helper/dbXmlQuery"),n=require("../helper/Release/getReleaseData"),i=require("../api/gtm"),u=require("../models/release"),l=e(require("../middleware/auth"));function d(e){return e.query.gtmVersion?+e.query.gtmVersion:+s.CONSTS.GTMVERSION}a.get("/",[l.default],s.asyncRouteHandler(async(e,t)=>{const{display:a}=e.query,{username:l,password:o,instance:p,url:c}=e.user,f=l.split(".")[0];if(a){const e=await u.Release(f,p).find({$or:[{display:a},{disabled:!0}]}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const m=d(e),y=await n.getReleaseSchema(m);if(!y)return t.status(400).send(`gtmVersion:${m} schema not available!`);const{data:R,error:g}=await s.asyncHandler(i.dbXml(c,r.getReleasePropsfromGtm,l,o));if(g)return t.status(400).send(g);const h=await n.getReleaseData(y,m,R,f);let w=await u.Release(f,p).find({}).sort({_id:1});return w&&0!==w.length?(w=await n.getUpdatedProp(h,w,p,f),a?t.status(200).json({data:w.filter(e=>e.display)}):t.status(200).json({data:w})):t.status(200).json({data:await u.Release(f,p).insertMany(h)})})),a.put("/",[l.default],s.asyncRouteHandler(async(e,t)=>{let{release:a}=e.body;const{username:s,instance:r}=e.user,n=s.split(".")[0];return a?(a=await u.Release(n,r).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Release prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Release/getReleaseData":"NFyl","../api/gtm":"KJs0","../models/release":"Yp05","../middleware/auth":"MNoc"}],"mbXe":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston"));function s(e,s,r,u){t.default.error(e.message,e),r.status(500).send("Something failed.")}exports.default=s;
},{}],"XNdw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),n=e=>{const t={};return a.default.keys(e).map(e=>m(e,t)).filter(e=>void 0!==e),t},m=(e,t)=>{switch(!0){case-1!==e.search("Remark"):i(e,t,"Remark");break;case-1!==e.search("ItemFeature"):i(e,t,"ItemFeature");break;case-1!==e.search("GtmItemClassification"):i(e,t,"GtmItemClassification");break;case-1!==e.search("GtmItemDescription"):i(e,t,"GtmItemDescription");break;case-1!==e.search("GtmItemCountryOfOrigin"):i(e,t,"GtmItemCountryOfOrigin");break;case-1!==e.search("GtmItemUomConversion"):i(e,t,"GtmItemUomConversion");break;case-1!==e.search("Refnum"):i(e,t,"Refnum");break;case-1!==e.search("PricePerUnit"):i(e,t,"PricePerUnit");break;default:i(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Item:{},Packaging:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("ItemMaster"):break;case-1!==a.search("Packaging"):s(a,e,t,"Packaging");break;default:s(a,e,t,"Item")}return t}).filter(e=>void 0!==e),t.Item=n(t.Item),t.Packaging=n(t.Packaging),{ItemMaster:t}});const s=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},i=(e,n,m)=>{let s=e,i=e;switch(!0){case"Remark"===m:s=r.convertPath(e,"Remark").newPath,i=r.convertPath(e,"Remark").newName;break;case"Refnum"===m:s=r.convertPath(e,"Refnum").newPath,i=r.convertPath(e,"Refnum").newName;break;case"ItemFeature"===m:s=r.convertPath(e,"ItemFeature").newPath,i=r.convertPath(e,"ItemFeature").newName;break;case"GtmItemClassification"===m:s=r.convertPath(e,"GtmItemClassification").newPath,i=r.convertPath(e,"GtmItemClassification").newName;break;case"GtmItemDescription"===m:s=r.convertPath(e,"GtmItemDescription").newPath,i=r.convertPath(e,"GtmItemDescription").newName;break;case"GtmItemCountryOfOrigin"===m:s=r.convertPath(e,"GtmItemCountryOfOrigin").newPath,i=r.convertPath(e,"GtmItemCountryOfOrigin").newName;break;case"GtmItemUomConversion"===m:s=r.convertPath(e,"GtmItemUomConversion").newPath,i=r.convertPath(e,"GtmItemUomConversion").newName}n[`${m}`]||(n[`${m}`]=[]),n[`${m}`].push({name:t.getElementName(i),path:s}),n[`${m}`]=a.default.uniqBy(n[`${m}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"RPHv":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?e(Object(s),!0).forEach(function(e){r(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=s(e,"string");return"symbol"==typeof t?t:String(t)}function s(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateItemSchema=void 0;const i=require("./../index"),o=a(require("express")),u=o.default.Router(),m=a(require("path")),l=a(require("fast-xml-parser")),c=a(require("flat")),f=require("../helper/other"),d=require("../helper/Item/schemaItemProps"),p=require("../models/schemaItem");async function g(){const e=m.default.join(i.ROOT_DIR,"XMLs","Item.xml"),r=await f.getFileData(e),n=l.default.getTraversalObj(r,{}),s=l.default.convertToJson(n,{}),a=c.default(s),o=d.getChilds(a);let{gtmVersion:u,xmlNsOtm:g,xmlNsGtm:O}=f.getXMlVersion(r);return u||(u=Number(f.CONSTS.GTMVERSION)),new p.SchemaItem(t({xmlNs:[g,O],gtmVersion:u},o)).save()}u.post("/",f.asyncRouteHandler(async(e,r)=>{const n=m.default.join(i.ROOT_DIR,"XMLs","Item.xml"),s=await f.getFileData(n),a=l.default.getTraversalObj(s,{}),o=l.default.convertToJson(a,{}),u=c.default(o),g=d.getChilds(u),{gtmVersion:O,xmlNsOtm:b,xmlNsGtm:y}=f.getXMlVersion(s);if(!O)return r.status(400).send("XML must contain Namespace");let h=await p.SchemaItem.findOne({gtmVersion:O});if(h){if(JSON.stringify(h.ItemMaster)===JSON.stringify(g.ItemMaster))return r.status(200).send(h);await p.SchemaItem.findByIdAndRemove(h._id)}return h=new p.SchemaItem(t({xmlNs:[b,y],gtmVersion:O},g)),h=await h.save(),r.status(200).send(h)})),u.get("/",f.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await p.SchemaItem.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await p.SchemaItem.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=u,exports.generateItemSchema=g;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Item/schemaItemProps":"XNdw","../models/schemaItem":"iDDx"}],"I17b":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),s=e=>{const t={};return a.default.keys(e).map(e=>n(e,t)).filter(e=>void 0!==e),t},n=(e,t)=>{switch(!0){case-1!==e.search("InvolvedParty"):i(e,t,"InvolvedParty");break;case-1!==e.search("Remark"):i(e,t,"Remark");break;case-1!==e.search("ItemAttributes"):i(e,t,"ItemAttributes");break;case-1!==e.search("Refnum"):i(e,t,"Refnum");break;case-1!==e.search("PricePerUnit"):i(e,t,"PricePerUnit");break;default:i(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Release:{},ReleaseLine:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("Release")||a.search("ReleaseStatus")>-1:break;case-1!==a.search("ReleaseLine"):c(a,e,t,"ReleaseLine");break;default:c(a,e,t,"Release")}return t}).filter(e=>void 0!==e),t.Release=s(t.Release),t.ReleaseLine=s(t.ReleaseLine),{Release:t}});const c=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},i=(e,s,n)=>{let c=e,i=e;switch(!0){case"Remark"===n:c=r.convertPath(e,"Remark").newPath,i=r.convertPath(e,"Remark").newName;break;case"InvolvedParty"===n:c=r.convertPath(e,"InvolvedParty").newPath,i=r.convertPath(e,"InvolvedParty").newName;break;case"Refnum"===n:c=r.convertPath(e,"Refnum").newPath,i=r.convertPath(e,"Refnum").newName;break;case"ItemAttributes"===n:c=r.convertPath(e,"ItemAttributes").newPath,i=r.convertPath(e,"ItemAttributes").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:t.getElementName(i),path:c}),s[`${n}`]=a.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"woBX":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?e(Object(s),!0).forEach(function(e){r(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=s(e,"string");return"symbol"==typeof t?t:String(t)}function s(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("./../index"),o=a(require("express")),u=o.default.Router(),l=a(require("path")),c=a(require("fast-xml-parser")),f=a(require("flat")),m=require("../helper/other"),d=require("../helper/Release/schemaReleaseProps"),p=require("../models/schemaRelease");u.post("/",m.asyncRouteHandler(async(e,r)=>{const n=l.default.join(i.ROOT_DIR,"XMLs","OrderRelease.xml"),s=await m.getFileData(n),a=c.default.getTraversalObj(s,{}),o=c.default.convertToJson(a,{}),u=f.default(o),O=d.getChilds(u),{gtmVersion:y,xmlNsOtm:b,xmlNsGtm:g}=m.getXMlVersion(s);if(!y)return r.status(400).send("XML must contain Namespace");let h=await p.SchemaRelease.findOne({gtmVersion:y});if(h){if(JSON.stringify(h.Release)===JSON.stringify(O.Release))return r.status(200).send(h);await p.SchemaRelease.findByIdAndRemove(h._id)}return h=new p.SchemaRelease(t({xmlNs:[b,g],gtmVersion:y},O)),h=await h.save(),r.status(200).send(h)})),u.get("/",m.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await p.SchemaRelease.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await p.SchemaRelease.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=u;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Release/schemaReleaseProps":"I17b","../models/schemaRelease":"Ys6U"}],"o5f2":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),n=require("../helper/other"),r=require("../helper/dbXmlQuery"),i=require("../helper/Item/getItemData"),s=require("../api/gtm"),d=require("../models/item"),u=e(require("../middleware/auth")),o=require("./schemaItem");async function l(e,t,a){return await d.Item(e,t).find({$or:[{display:a},{disabled:!0}]}).sort({_id:1})}async function m(e,t,a){return e=await d.Item(t,a).findByIdAndUpdate(e._id,e,{new:!0})}async function c(e,t){return await d.Item(e,t).find({}).sort({_id:1})}function f(e){return{data:e.filter(e=>e.display)}}async function y(e,t,a){return{data:await d.Item(e,t).insertMany(a)}}function p(e){return!e||0===e.length}function w(e){return e.split(".")[0]}function I(e){return e.query.gtmVersion?+e.query.gtmVersion:+n.CONSTS.GTMVERSION}a.get("/",[u.default],n.asyncRouteHandler(async(e,t)=>{const{display:a}=e.query,{username:d,password:u,instance:m,url:_}=e.user,g=w(d);if(a){const e=await l(g,m,a);if(e.length)return t.status(200).json({data:e})}const h=I(e);let q=await i.getItemSchema(h);q||(q=await o.generateItemSchema());const{data:j,error:x}=await n.asyncHandler(s.dbXml(_,r.getItemPropfromGtm,d,u));if(x)return t.status(400).send(x);const b=await i.getItemData(q,h,j,g);let A=await c(g,m);return p(A)?t.status(200).json(await y(g,m,b)):(A=await i.getUpdatedProp(b,A,m,g),a?t.status(200).json(f(A)):t.status(200).json({data:A}))})),a.put("/",[u.default],n.asyncRouteHandler(async(e,t)=>{const{instance:a,username:n}=e.user,r=w(n);let{item:i}=e.body;return i?(i=await m(i,r,a),t.status(200).json({data:i})):t.status(400).send("Item prop value missing!")})),a.put("/swap",[u.default],n.asyncRouteHandler(async(e,t)=>{const{instance:a,username:n}=e.user,r=w(n);let{items:i}=e.body;if(!i||0==i.length)return t.status(400).send("Not a valid item list!");i[0]=await d.Item(r,a).findByIdAndUpdate({_id:i[0]._id},i[0],{new:!0}).exec(),i[1]=await d.Item(r,a).findByIdAndUpdate({_id:i[1]._id},i[1],{new:!0}).exec();let s=await d.Item(r,a).find({name:i[1].name}),u=await d.Item(r,a).find({name:i[0].name});return s.length>1&&await d.Item(r,a).findByIdAndDelete({_id:s[1]._id}).exec(),u.length>1&&await d.Item(r,a).findByIdAndDelete({_id:u[1]._id}).exec(),t.status(200).json({data:i})})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Item/getItemData":"UQUS","../api/gtm":"KJs0","../models/item":"z2rt","../middleware/auth":"MNoc","./schemaItem":"RPHv"}],"Yjam":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Location=void 0;const o=e(require("mongoose")),t=new o.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Location=((e,a)=>o.default.model("Location",t,`${e}_Location_${a}`));
},{}],"EPD9":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaLocation=void 0;const t=e(require("mongoose")),o=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Location:{type:"Mixed"}});exports.SchemaLocation=t.default.model("SchemaLocation",o,"LocationSchema");
},{}],"Dqth":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapAddressLine=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=["Location TransactionCode","Location ID DomainName","Location ID","Party ID DomainName","Party ID","Party TransactionCode"],r=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},p=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}exports.mapHeader=((e,r,p,n,l)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),type:r,displayText:e.name,defaultValue:a.getDefaultValue(e.path,l),path:[e.path],gtmVersion:p,xmlNs:n})),exports.mapRefnum=((t,n,l,i,m,s,o)=>{const d=p(n,"Xid"),u=p(n,"DomainName"),c=p(n,"RefnumValue"),h=p(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:r(0,0,t),defaultValue:a.getDefaultValue(n[c].path,o),path:[{path:n[c].path.replace("INDEX",s),value:""},e.getDomainName(t,n[u].path.replace("INDEX",s)),e.getTC(t,n[h].path.replace("INDEX",s)),e.getXID(t,n[d].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapRemark=((t,n,l,i,m,s,o)=>{const d=p(n,"Xid"),u=p(n,"DomainName"),c=p(n,"RemarkText"),h=p(n,"RemarkSequence"),D=p(n,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:l,displayText:r(0,0,t),defaultValue:a.getDefaultValue(n[c].path,o),path:[{path:n[c].path.replace("INDEX",s),value:""},e.getTC(t,n[D].path.replace("INDEX",s)),e.getSequence(t,n[h].path.replace("INDEX",s),s),e.getDomainName(t,n[u].path.replace("INDEX",s)),e.getXID(t,n[d].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapAddressLine=((a,t,p,n,l,i,m,s)=>{return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:p,displayText:`${m} ${r(0,0,a)}`.trim(),defaultValue:"",path:[e.getSequence(a,t[0].path.replace("INDEX",i),i),{path:t[1].path.replace("INDEX",i),value:""}],gtmVersion:n,xmlNs:l}});
},{"../other":"irtd","../renamer":"jN2X"}],"wmMx":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getLocationData=exports.getLocationSchema=void 0;const a=e(require("lodash")),t=e(require("promise-memoize")),o=require("../../models/location"),n=require("../../models/schemaLocation"),i=require("./locationProps");function r(e,t,o,n){return new Promise(function(r){let{Header:d,Remark:c,Refnum:m}=e.Location,{AddressLines:s}=e.Location,{Header:u}=e.Location.Contact,{Header:p}=e.Location.ServiceProvider;const f=e.xmlNs;d=d.map(e=>i.mapHeader(e,"Location : Header",t,f,n)),u=u.map(e=>i.mapHeader(e,"Party : Header",t,f,n)),p=p.map(e=>i.mapHeader(e,"ServiceProvider : Header",t,f,n));const l=o.match(/REMARKS="(.*?)"/)[1].split(",");c=l.map((e,a)=>i.mapRemark(e,c,"Location : Remark",t,f,a,n));const L=o.match(/REFNUMS="(.*?)"/)[1].split(",");m=L.map((e,a)=>i.mapRefnum(e,m,"Location : Refnum",t,f,a,n)),s=[1,2,3].map(e=>i.mapAddressLine(`Address Line ${e}`,s,"Location : Address Line",t,f,e-1,"",n)),r(a.default.uniqBy([...d,...c,...m,...s,...u,...p],e=>e.name))})}function d(e,t,n,i){return new Promise(async function(r){const d=a.default.differenceWith(e,t,(e,a)=>e.name===a.name),c=a.default.differenceWith(t,e,(e,a)=>e.name===a.name);if(d.length>0){const e=await o.Location(i,n).insertMany(d);r([...t,...e])}else c.length>0?(await o.Location(i,n).deleteMany({_id:{$in:[...c.map(e=>e._id)]}}),r(a.default.differenceWith(t,c,(e,a)=>e.name===a.name))):r(t)})}function c(e){return n.SchemaLocation.findOne({gtmVersion:e}).sort({_id:1})}exports.getLocationSchema=t.default(c,{maxAge:6e4}),exports.getLocationData=t.default(r,{maxAge:6e4}),exports.getUpdatedProp=t.default(d,{maxAge:6e4});
},{"../../models/location":"Yjam","../../models/schemaLocation":"EPD9","./locationProps":"Dqth"}],"pk3O":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/Location/getLocationData"),o=require("../api/gtm"),i=require("../models/location"),u=t(require("../middleware/auth"));function d(t){return t.query.gtmVersion?+t.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[u.default],r.asyncRouteHandler(async(t,e)=>{const{display:a}=t.query,{username:u,password:l,instance:c,url:p}=t.user,f=u.split(".")[0];if(a){const t=await i.Location(f,c).find({$or:[{display:a},{disabled:!0}]}).sort({_id:1});if(t.length)return e.status(200).json({data:t})}const m=d(t),y=await n.getLocationSchema(m);if(!y)return e.status(400).send(`gtmVersion:${m} schema not available!`);const{data:g,error:h}=await r.asyncHandler(o.dbXml(p,s.getLocationPropfromOtm,u,l));if(h)return e.status(400).send(h);const w=await n.getLocationData(y,m,g,f);let q=await i.Location(f,c).find({}).sort({_id:1});return q&&0!==q.length?(q=await n.getUpdatedProp(w,q,c,f),a?e.status(200).json({data:q.filter(t=>t.display)}):e.status(200).json({data:q})):e.status(200).json({data:await i.Location(f,c).insertMany(w)})})),a.put("/",[u.default],r.asyncRouteHandler(async(t,e)=>{let{location:a}=t.body;const{username:r,instance:s}=t.user,n=r.split(".")[0];return a?(a=await i.Location(n,s).findByIdAndUpdate(a._id,a,{new:!0}),e.status(200).json({data:a})):e.status(400).send("Location prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Location/getLocationData":"wmMx","../api/gtm":"KJs0","../models/location":"Yjam","../middleware/auth":"MNoc"}],"bvcS":[function(require,module,exports) {
"use strict";function e(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function r(r){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach(function(e){t(r,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function t(e,r,t){return(r=n(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(e){var r=o(e,"string");return"symbol"==typeof r?r:String(r)}function o(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const i=require("../renamer"),c=a(require("lodash")),s=require("../other"),u=e=>{const r={};return c.default.keys(e).map(e=>f(e,r)).filter(e=>void 0!==e),r},f=(e,r)=>{switch(!0){case-1!==e.search("Remark"):v(e,r,"Remark");break;case-1!==e.search("Refnum"):v(e,r,"Refnum");break;case-1!==e.search("AddressLines"):v(e,r,"AddressLines");break;default:v(e,r,"Header")}return r};exports.getChilds=(e=>{const t={Locations:{},Contact:{},ServiceProvider:{}};return c.default.keys(e).map(r=>{switch(!0){case-1===r.search("Location"):break;case-1!==r.search("Contact"):d(r,e,t,"Contact");break;case-1!==r.search("ServiceProvider"):d(r,e,t,"ServiceProvider");break;default:d(r,e,t,"Locations")}return t}).filter(e=>void 0!==e),t.Locations=u(t.Locations),t.Contact=u(t.Contact),t.ServiceProvider=u(t.ServiceProvider),t.Locations.Contact=r({},t.Contact),t.Locations.ServiceProvider=r({},t.ServiceProvider),{Location:t.Locations}});const d=(e,r,t,n)=>{t[`${n}`][`${e}`]=r[`${e}`]},v=(e,r,t)=>{let n=e,o=e;switch(!0){case"Remark"===t:n=s.convertPath(e,"Remark").newPath,o=s.convertPath(e,"Remark").newName;break;case"Refnum"===t:n=s.convertPath(e,"Refnum").newPath,o=s.convertPath(e,"Refnum").newName;break;case"AddressLines"===t:n=s.convertPath(e,"AddressLines").newPath,o=s.convertPath(e,"AddressLines").newName}r[`${t}`]||(r[`${t}`]=[]),r[`${t}`].push({name:i.getElementName(o),path:n}),r[`${t}`]=c.default.uniqBy(r[`${t}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"ZmvT":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=i(e,"string");return"symbol"==typeof t?t:String(t)}function i(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=require("./../index"),s=o(require("express")),u=s.default.Router(),c=o(require("path")),l=o(require("fast-xml-parser")),f=o(require("flat")),m=require("../helper/other"),d=require("../helper/Location/schemaLocationProps"),p=require("../models/schemaLocation");u.post("/",m.asyncRouteHandler(async(e,r)=>{const n=c.default.join(a.ROOT_DIR,"XMLs","Location.xml"),i=await m.getFileData(n),o=l.default.getTraversalObj(i,{}),s=l.default.convertToJson(o,{}),u=f.default(s),y=d.getChilds(u),{gtmVersion:O,xmlNsOtm:b,xmlNsGtm:g}=m.getXMlVersion(i);if(!O)return r.status(400).send("XML must contain Namespace");let h=await p.SchemaLocation.findOne({gtmVersion:O});if(h){if(JSON.stringify(h.Location)===JSON.stringify(y.Location))return r.status(200).send(h);await p.SchemaLocation.findByIdAndRemove(h._id)}return h=new p.SchemaLocation(t({xmlNs:[b,g],gtmVersion:O},y)),h=await h.save(),r.status(200).send(h)})),u.get("/",m.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await p.SchemaLocation.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await p.SchemaLocation.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=u;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Location/schemaLocationProps":"bvcS","../models/schemaLocation":"EPD9"}],"Ovyc":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Party=void 0;const t=e(require("mongoose")),r=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Party=((e,a)=>t.default.model("Party",r,`${e}_Party_${a}`));
},{}],"axFa":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaParty=void 0;const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},GtmContact:{type:"Mixed"}});exports.SchemaParty=t.default.model("SchemaParty",r,"PartySchema");
},{}],"Bhcp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapAddressLine=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),r=["Party TransactionCode","Party ID DomainName","Party ID",...Object.values(t.NAME.party)],p=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},l=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}exports.mapHeader=((e,t,p,l,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,r),display:a.getMandatoryElement(e.name,r),isMandatory:a.getMandatoryElement(e.name,r),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:p,xmlNs:l})),exports.mapRefnum=((t,r,n,i,m,s,d,u)=>{const o=l(r,"Xid"),c=l(r,"DomainName"),h=l(r,"RefnumValue"),D=l(r,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${d} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[h].path,u),path:[{path:r[h].path.replace("INDEX",s),value:""},e.getDomainName(t,r[c].path.replace("INDEX",s)),e.getTC(t,r[D].path.replace("INDEX",s)),e.getXID(t,r[o].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapRemark=((t,r,n,i,m,s,d)=>{const u=l(r,"Xid"),o=l(r,"DomainName"),c=l(r,"RemarkText"),h=l(r,"RemarkSequence"),D=l(r,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:n,displayText:p(0,0,t),defaultValue:a.getDefaultValue(r[c].path,d),path:[{path:r[c].path.replace("INDEX",s),value:""},e.getTC(t,r[D].path.replace("INDEX",s)),e.getSequence(t,r[h].path.replace("INDEX",s),s),e.getDomainName(t,r[o].path.replace("INDEX",s)),e.getXID(t,r[u].path.replace("INDEX",s))],gtmVersion:i,xmlNs:m}}),exports.mapAddressLine=((a,t,r,l,n,i,m,s)=>{return{name:`${m} ${a}`.trim(),required:!0,disabled:!1,display:!1,type:r,displayText:`${m} ${p(0,0,a)}`.trim(),defaultValue:"",path:[{path:t[1].path.replace("INDEX",i),value:""},e.getSequence(a,t[0].path.replace("INDEX",i),i)],gtmVersion:l,xmlNs:n}});
},{"../other":"irtd","../renamer":"jN2X"}],"dEF4":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getPartyData=exports.getPartySchema=void 0;const t=e(require("lodash")),r=e(require("promise-memoize")),n=require("../../models/party"),a=require("../../models/schemaParty"),o=require("./partyProps");function i(e,r,n,a){return new Promise(function(o){let{Header:i,Remark:m,Refnum:f}=e.GtmContact.Contact,{Header:p}=e.GtmContact.LocationRef,{AddressLines:l}=e.GtmContact.LocationRef;const P=e.xmlNs;({PHeader:i,PLocRef:p}=s(i,r,P,a,p)),m=d(n,m,r,P,a),l=u(l,r,P,a),o(t.default.uniqBy([...i,...m,...f,...p,...l],c()))})}function u(e,t,r,n){return e=[1,2,3].map(f(e,t,r,n))}function m(e,t,r,n,a){return null}function d(e,t,r,n,a){console.log(e);const i=e.match(/REMARKS="(.*?)"/)[1].split(",");return t=i.map((e,i)=>o.mapRemark(e,t,"Party : Remark",r,n,i,a))}function s(e,t,r,n,a){return{PHeader:e=e.map(P(t,r,n)),PLocRef:a=a.map(l(t,r,n))}}function c(){return e=>e.name}function f(e,t,r,n){return a=>o.mapAddressLine(`Address Line ${a}`,e,"Party : Address Line",t,r,a-1,"",n)}function p(e,t,r,n){return(a,i)=>o.mapRefnum(a,e,"Party : Refnum",t,r,i,"",n)}function l(e,t,r){return n=>o.mapHeader(n,"LocationRef : Header",e,t,r)}function P(e,t,r){return n=>o.mapHeader(n,"Party : Header",e,t,r)}function y(e,r,a,o){return new Promise(async function(i){const u=t.default.differenceWith(e,r,(e,t)=>e.name===t.name),m=t.default.differenceWith(r,e,(e,t)=>e.name===t.name);if(u.length>0){const e=await n.Party(o,a).insertMany(u);i([...r,...e])}else m.length>0?(await n.Party(o,a).deleteMany({_id:{$in:[...m.map(e=>e._id)]}}),i(t.default.differenceWith(r,m,(e,t)=>e.name===t.name))):i(r)})}function g(e){return a.SchemaParty.findOne({gtmVersion:e}).sort({_id:1})}exports.getPartySchema=r.default(g,{maxAge:6e4}),exports.getPartyData=r.default(i,{maxAge:6e4}),exports.getUpdatedProp=r.default(y,{maxAge:6e4});
},{"../../models/party":"Ovyc","../../models/schemaParty":"axFa","./partyProps":"Bhcp"}],"HAOJ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),n=e=>{const t={};return a.default.keys(e).map(e=>s(e,t)).filter(e=>void 0!==e),t},s=(e,t)=>{switch(!0){case-1!==e.search("Remark"):o(e,t,"Remark");break;case-1!==e.search("Refnum"):o(e,t,"Refnum");break;case-1!==e.search("AddressLines"):o(e,t,"AddressLines");break;default:o(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Contact:{},LocationRef:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("GtmContact"):break;case-1!==a.search("LocationRef"):c(a,e,t,"LocationRef");break;default:c(a,e,t,"Contact")}return t}).filter(e=>void 0!==e),t.Contact=n(t.Contact),t.LocationRef=n(t.LocationRef),{GtmContact:t}});const c=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},o=(e,n,s)=>{let c=e,o=e;switch(!0){case"Remark"===s:c=r.convertPath(e,"Remark").newPath,o=r.convertPath(e,"Remark").newName;break;case"Refnum"===s:c=r.convertPath(e,"Refnum").newPath,o=r.convertPath(e,"Refnum").newName;break;case"AddressLines"===s:c=r.convertPath(e,"AddressLines").newPath,o=r.convertPath(e,"AddressLines").newName}n[`${s}`]||(n[`${s}`]=[]),n[`${s}`].push({name:t.getElementName(o),path:c}),n[`${s}`]=a.default.uniqBy(n[`${s}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"abiS":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?e(Object(a),!0).forEach(function(e){r(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=a(e,"string");return"symbol"==typeof t?t:String(t)}function a(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generatePartySchema=void 0;const i=require("./../index"),o=s(require("express")),u=o.default.Router(),c=s(require("path")),l=s(require("fast-xml-parser")),m=s(require("flat")),f=require("../helper/other"),y=require("../helper/Party/schemaPartyProps"),d=require("../models/schemaParty");async function p(){const e=c.default.join(i.ROOT_DIR,"XMLs","Party.xml"),r=await f.getFileData(e),n=l.default.getTraversalObj(r,{}),a=l.default.convertToJson(n,{}),s=m.default(a),o=y.getChilds(s);let{gtmVersion:u,xmlNsOtm:p,xmlNsGtm:g}=f.getXMlVersion(r);return u||(u=Number(f.CONSTS.GTMVERSION)),new d.SchemaParty(t({xmlNs:[p,g],gtmVersion:u},o)).save()}u.post("/",f.asyncRouteHandler(async(e,r)=>{const n=c.default.join(i.ROOT_DIR,"XMLs","Party.xml"),a=await f.getFileData(n),s=l.default.getTraversalObj(a,{}),o=l.default.convertToJson(s,{}),u=m.default(o),p=y.getChilds(u),{gtmVersion:g,xmlNsOtm:O,xmlNsGtm:b}=f.getXMlVersion(a);if(!g)return r.status(400).send("XML must contain Namespace");let P=await d.SchemaParty.findOne({gtmVersion:g});if(P){if(JSON.stringify(P.GtmContact)===JSON.stringify(p.GtmContact))return r.status(200).send(P);await d.SchemaParty.findByIdAndRemove(P._id)}return P=new d.SchemaParty(t({xmlNs:[O,b],gtmVersion:g},p)),P=await P.save(),r.status(200).send(P)})),u.get("/",f.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await d.SchemaParty.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await d.SchemaParty.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=u,exports.generatePartySchema=p;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Party/schemaPartyProps":"HAOJ","../models/schemaParty":"axFa"}],"TT7J":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/Party/getPartyData"),i=require("../api/gtm"),d=require("../models/party"),u=t(require("../middleware/auth")),o=require("./schemaParty");async function y(t,e,a){return await d.Party(t,e).find({$or:[{display:a},{disabled:!0}]}).sort({_id:1})}async function l(t,e){return await d.Party(t,e).find({}).sort({_id:1})}function c(t){return{data:t.filter(t=>t.display)}}async function f(t,e,a){return{data:await d.Party(t,e).insertMany(a)}}function p(t){return!t||0===t.length}function w(t){return+t.query.gtmVersion||+r.CONSTS.GTMVERSION}function m(t){return t.split(".")[0]}a.get("/",[u.default],r.asyncRouteHandler(async(t,e)=>{const{display:a}=t.query,{username:d,password:u,instance:P,url:_}=t.user,g=m(d);if(a){const t=await y(g,P,a);if(t.length)return e.status(200).json({data:t})}const h=w(t);let q=await s.getPartySchema(h);q||(q=await o.generatePartySchema());const{data:j,error:x}=await r.asyncHandler(i.dbXml(_,n.getPartyPropfromGtm,d,u));if(x)return e.status(400).send(x);const b=await s.getPartyData(q,h,j,g);let I=await l(g,P);return p(I)?e.status(200).json(await f(g,P,b)):(I=await s.getUpdatedProp(b,I,P,g),a?e.status(200).json(c(I)):e.status(200).json({data:I}))})),a.put("/",[u.default],r.asyncRouteHandler(async(t,e)=>{let{party:a}=t.body;const{username:r,instance:n}=t.user,s=m(r);return a?(a=await d.Party(s,n).findByIdAndUpdate(a._id,a,{new:!0}),e.status(200).json({data:a})):e.status(400).send("Party prop value missing!")})),a.put("/swap",[u.default],r.asyncRouteHandler(async(t,e)=>{const{instance:a,username:r}=t.user,n=m(r);let{partys:s}=t.body;if(!s||0==s.length)return e.status(400).send("Not a valid item list!");s[0]=await d.Party(n,a).findByIdAndUpdate({_id:s[0]._id},s[0],{new:!0}).exec(),s[1]=await d.Party(n,a).findByIdAndUpdate({_id:s[1]._id},s[1],{new:!0}).exec();let i=await d.Party(n,a).find({name:s[1].name}),u=await d.Party(n,a).find({name:s[0].name});return i.length>1&&await d.Party(n,a).findByIdAndDelete({_id:i[1]._id}).exec(),u.length>1&&await d.Party(n,a).findByIdAndDelete({_id:u[1]._id}).exec(),e.status(200).json({data:s})})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Party/getPartyData":"dEF4","../api/gtm":"KJs0","../models/party":"Ovyc","../middleware/auth":"MNoc","./schemaParty":"abiS"}],"fEfK":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transaction=void 0;const t=e(require("mongoose")),a=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Transaction=((e,o)=>t.default.model("Transaction",a,`${e}_Transaction_${o}`));
},{}],"Poy0":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaTransaction=void 0;const t=e(require("mongoose")),a=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},GtmTransaction:{type:"Mixed"}});exports.SchemaTransaction=t.default.model("SchemaTransaction",a,"TransactionSchema");
},{}],"JLzc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapTrxLineItemId=exports.mapDate=exports.mapInvolvedParty=exports.mapCurrency=exports.mapQuantity=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=["Transaction ID DomainName","Transaction ID","Transaction TransactionCode","Line ID DomainName","Line ID","Line TransactionCode"],r=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},p=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};exports.mapHeader=((e,r,p,i,l)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),type:r,displayText:e.name,defaultValue:a.getDefaultValue(e.path,l),isMandatory:a.getMandatoryElement(e.name,t),path:[e.path],gtmVersion:p,xmlNs:i})),exports.mapRefnum=((t,i,l,n,m,d,u,o)=>{const s=p(i,"Xid"),D=p(i,"DomainName"),c=p(i,"RefnumValue"),h=p(i,"TransactionCode");return{name:`${u} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${u} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path.replace("INDEX",d),value:""},e.getDomainName(t,i[D].path.replace("INDEX",d)),e.getTC(t,i[h].path.replace("INDEX",d)),e.getXID(t,i[s].path.replace("INDEX",d))],gtmVersion:n,xmlNs:m}}),exports.mapRemark=((t,i,l,n,m,d,u,o)=>{const s=p(i,"Xid"),D=p(i,"DomainName"),c=p(i,"RemarkText"),h=p(i,"RemarkSequence"),y=p(i,"TransactionCode");return{name:`${u} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${u} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path.replace("INDEX",d),value:""},e.getTC(t,i[y].path.replace("INDEX",d)),e.getSequence(t,i[h].path.replace("INDEX",d),d),e.getDomainName(t,i[D].path.replace("INDEX",d)),e.getXID(t,i[s].path.replace("INDEX",d))],gtmVersion:n,xmlNs:m}}),exports.mapQuantity=((t,i,l,n,m,d,u,o)=>{t=t.split("[")[0];const s=p(i,/QuantityTypeGid(.*?)Xid/),D=p(i,/QuantityTypeGid(.*?)DomainName/),c=p(i,/Quantity(.*?)QuantityValue/),h=p(i,/Quantity(.*?)TransactionCode/);return{name:`${u} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${u} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path.replace("INDEX",d),value:""},e.getTC(t,i[h].path.replace("INDEX",d)),e.getDomainName(t,i[D].path.replace("INDEX",d)),e.getXID(t,i[s].path.replace("INDEX",d))],gtmVersion:n,xmlNs:m}}),exports.mapCurrency=((t,i,l,n,m,d,u,o)=>{const s=p(i,/GtmCurrencyTypeGid(.*?)Xid/),D=p(i,/GtmCurrencyTypeGid(.*?)DomainName/),c=p(i,/CurrencyValue(.*?)MonetaryAmount/),h=p(i,/CurrencyValue(.*?)GlobalCurrencyCode/);return{name:`${u} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${u} ${r(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path.replace("INDEX",d),value:""},e.getDomainName(t,i[D].path.replace("INDEX",d)),{path:i[h].path.replace("INDEX",d),value:"USD"},e.getXID(t,i[s].path.replace("INDEX",d))],gtmVersion:n,xmlNs:m}}),exports.mapInvolvedParty=((t,i,l,n,m,d,u,o="")=>{const s=p(i,/InvolvedPartyQualifierGid(.*?)Xid/),D=p(i,"DomainName"),c=p(i,/ContactGid(.*?)Xid/),h=p(i,/ContactGid(.*?)DomainName/),y=p(i,"TransactionCode");return{name:`${u} ${t} (Party ID)`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${u} ${r(0,0,t)} (Party ID)`.trim(),defaultValue:a.getDefaultValue(i[c].path,o),path:[{path:i[c].path.replace("INDEX",d),value:""},e.getTC(t,i[y].path.replace("INDEX",d)),{path:i[h].path.replace("INDEX",d),value:o},e.getDomainName(t,i[D].path.replace("INDEX",d)),e.getXID(t,i[s].path.replace("INDEX",d))],gtmVersion:n,xmlNs:m}}),exports.mapDate=((t,i,l,n,m,d,u,o="")=>{const s=p(i,/DateQualifierGid(.*?)Xid/),D=p(i,/TransactionDate(.*?)GLogDate/),c=p(i,/DateQualifierGid(.*?)DomainName/);return{name:`${u} ${t} (YYYY-MM-DD)`.trim(),required:!0,disabled:!1,display:!1,type:l,displayText:`${u} ${r(0,0,t)} (YYYY-MM-DD)`.trim(),defaultValue:a.getDefaultValue(i[D].path,o),path:[{path:i[D].path.replace("INDEX",d),value:""},e.getDomainName(t,i[c].path.replace("INDEX",d)),e.getXID(t,i[s].path.replace("INDEX",d))],gtmVersion:n,xmlNs:m}}),exports.mapTrxLineItemId=((e,a,t,r,i,l,n,m="")=>{const d=p(a,/ItemGid(.*?)Xid/),u=p(a,/ItemGid(.*?)DomainName/);return{name:`${n} Item ID`.trim(),required:!0,disabled:!1,display:!1,type:t,displayText:`${n} Item ID`.trim(),defaultValue:"",path:[{path:a[d].path.replace("INDEX",l),value:""},{path:a[u].path.replace("INDEX",l),value:m}],gtmVersion:r,xmlNs:i}});
},{"../other":"irtd","../renamer":"jN2X"}],"ZiiO":[function(require,module,exports) {
"use strict";var n=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getIncotermsFromGtm=exports.getUpdatedProp=exports.getTransactionData=exports.getTransactionSchema=void 0;const e=n(require("lodash")),t=n(require("promise-memoize")),r=require("../../models/transaction"),a=require("../../models/schemaTransaction"),i=require("./transactionProps"),o=require("../other"),u=require("../../api/gtm"),c=require("../dbXmlQuery");function m(n,t,r,a){return new Promise(function(i){let{Header:o,Remark:u,Refnum:c,InvolvedParty:m,TransDate:y,Quantity:R,Currency:L}=n.GtmTransaction.GtmTransaction,{Header:g,Remark:h,Refnum:I,InvolvedParty:D,ItemGid:v,TransLineDate:P,Quantity:E,Currency:H}=n.GtmTransaction.GtmTransactionLine;const k=n.xmlNs;({TrxHeader:o,TrxLineHeader:g}=x(o,t,k,a,g)),({TrxRemark:u,TrxLineRemark:h}=l(r,u,t,k,a,h)),({TrxDate:y,TrxLineDate:P}=d(r,y,t,k,a,P)),v=T(v,t,k,a),({TrxRefnum:c,TrxLineRefnum:I}=p(r,c,t,k,a,I)),({TrxInvPty:m,TrxLineInvPty:D}=f(r,m,t,k,a,D)),i(e.default.uniqBy([...o,...u,...c,...m,...y,...g,...v,...h,...I,...D,...P],s()))})}function s(){return n=>n.name}function f(n,e,t,r,a,i){const o=n.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");return{TrxInvPty:e=o.map(R(e,t,r,a)),TrxLineInvPty:i=o.map(y(i,t,r,a))}}function p(n,e,t,r,a,i){const o=n.match(/REFNUMS="(.*?)"/)[1].split(",");return{TrxRefnum:e=o.map(g(e,t,r,a)),TrxLineRefnum:i=o.map(L(i,t,r,a))}}function T(n,e,t,r){return n=[0].map(h(n,e,t,r))}function d(n,e,t,r,a,i){const o=n.match(/DATES="(.*?)"/)[1].split(",");return{TrxDate:e=o.map(E(e,t,r,a)),TrxLineDate:i=o.map(P(i,t,r,a))}}function l(n,e,t,r,a,i){const o=n.match(/REMARKS="(.*?)"/)[1].split(",");return{TrxRemark:e=o.map(k(e,t,r,a)),TrxLineRemark:i=o.map(H(i,t,r,a))}}function x(n,e,t,r,a){return{TrxHeader:n=n.map(q(e,t,r)),TrxLineHeader:a=a.map(_(e,t,r))}}function y(n,e,t,r){return(a,o)=>i.mapInvolvedParty(a,n,"Transaction Line : Involved Party",e,t,o,"Line",r)}function R(n,e,t,r){return(a,o)=>i.mapInvolvedParty(a,n,"Transaction : Involved Party",e,t,o,"",r)}function L(n,e,t,r){return(a,o)=>i.mapRefnum(a,n,"Transaction Line : Refnum",e,t,o,"Line",r)}function g(n,e,t,r){return(a,o)=>i.mapRefnum(a,n,"Transaction : Refnum",e,t,o,"",r)}function h(n,e,t,r){return(a,o)=>i.mapTrxLineItemId(a,n,"Transaction Line : Header",e,t,0,"Line",r)}function I(n,e,t,r){return(a,o)=>i.mapCurrency(a,n,"Transaction Line : Currency",e,t,o,"Line",r)}function D(n,e,t,r){return(a,o)=>i.mapCurrency(a,n,"Transaction : Currency",e,t,o,"",r)}function v(n,e,t,r){return(a,o)=>i.mapQuantity(a,n,"Transaction : Quantity",e,t,o,"",r)}function P(n,e,t,r){return(a,o)=>i.mapDate(a,n,"Transaction Line : Date",e,t,o,"Line",r)}function E(n,e,t,r){return(a,o)=>i.mapDate(a,n,"Transaction : Date",e,t,o,"",r)}function H(n,e,t,r){return(a,o)=>i.mapRemark(a,n,"Transaction Line : Remark",e,t,o,"Line",r)}function k(n,e,t,r){return(a,o)=>i.mapRemark(a,n,"Transaction : Remark",e,t,o,"",r)}function _(n,e,t){return r=>i.mapHeader(r,"Transaction Line : Header",n,e,t)}function q(n,e,t){return r=>i.mapHeader(r,"Transaction : Header",n,e,t)}function S(n,t,a,i){return new Promise(async function(o){const u=e.default.differenceWith(n,t,(n,e)=>n.name===e.name),c=e.default.differenceWith(t,n,(n,e)=>n.name===e.name);if(u.length>0){const n=await r.Transaction(i,a).insertMany(u);o([...t,...n])}else c.length>0?(await r.Transaction(i,a).deleteMany({_id:{$in:[...c.map(n=>n._id)]}}),o(e.default.differenceWith(t,c,(n,e)=>n.name===e.name))):o(t)})}function A(n){return a.SchemaTransaction.findOne({gtmVersion:n}).sort({_id:1})}async function G(n,e,t){const{data:r}=await o.asyncHandler(u.dbXml(n,c.getIncotermFromGtm,e,t));return M(r)}function M(n){const e=/INCOTERM="(.*?)"/g,t={};let r;for(;r=e.exec(n);){t[r.pop()]=1}return Object.keys(t).length>0?t:{}}function N(n){const e=n.match(/QUANTITY_UOM="(.*?)"/)[1].split(","),t={};return e.forEach(n=>{t[n.replace(/.*\[|\]/gi,"")]?t[n.replace(/.*\[|\]/gi,"")].push(n.split("[")[0]):t[n.replace(/.*\[|\]/gi,"")]=[n.split("[")[0]],t["USER DEFINED"]?t["USER DEFINED"].push(n.split("[")[0]):t["USER DEFINED"]=[n.split("[")[0]]}),t}exports.getTransactionSchema=t.default(A,{maxAge:6e4}),exports.getTransactionData=t.default(m,{maxAge:6e4}),exports.getUpdatedProp=t.default(S,{maxAge:6e4}),exports.getIncotermsFromGtm=t.default(G,{maxAge:6e4});
},{"../../models/transaction":"fEfK","../../models/schemaTransaction":"Poy0","./transactionProps":"JLzc","../other":"irtd","../../api/gtm":"KJs0","../dbXmlQuery":"bJb7"}],"THe0":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const a=require("../renamer"),t=e(require("lodash")),n=require("../other"),r=e=>{const a={};return t.default.keys(e).map(e=>c(e,a)).filter(e=>void 0!==e),a},c=(e,a)=>{switch(!0){case-1!==e.search("ItemGid"):o(e,a,"ItemGid");break;case-1!==e.search("TransLineDate"):o(e,a,"TransLineDate");break;case-1!==e.search("TransDate"):o(e,a,"TransDate");break;case-1!==e.search("TransactionInvLocation"):o(e,a,"TransactionInvLocation");break;case-1!==e.search("InvolvedParty"):o(e,a,"InvolvedParty");break;case-1!==e.search("UserDefinedClassification"):o(e,a,"UserDefinedClassification");break;case-1!==e.search("PortInfo"):o(e,a,"PortInfo");break;case-1!==e.search("Remark"):o(e,a,"Remark");break;case-1!==e.search("Refnum"):o(e,a,"Refnum");break;case-1!==e.search("Contact"):o(e,a,"Contact");break;default:o(e,a,"Header")}return a};exports.getChilds=(e=>{const a={GtmTransaction:{},GtmTransactionLine:{}};return t.default.keys(e).map(t=>{switch(!0){case-1===t.search("GtmTransaction"):break;case-1!==t.search("GtmTransactionLine"):s(t,e,a,"GtmTransactionLine");break;default:s(t,e,a,"GtmTransaction")}return a}).filter(e=>void 0!==e),a.GtmTransaction=r(a.GtmTransaction),a.GtmTransactionLine=r(a.GtmTransactionLine),{GtmTransaction:a}});const s=(e,a,t,n)=>{t[`${n}`][`${e}`]=a[`${e}`]},o=(e,r,c)=>{let s=e,o=e;switch(!0){case"ItemGid"===c:s=n.convertPath(e,"ItemGid").newPath,o=n.convertPath(e,"ItemGid").newName;break;case"Currency"===c:s=n.convertPath(e,"Currency").newPath,o=n.convertPath(e,"Currency").newName;break;case"TransactionCurrency"===c:s=n.convertPath(e,"TransactionCurrency").newPath,o=n.convertPath(e,"TransactionCurrency").newName;break;case"Quantity"===c:s=n.convertPath(e,"Quantity").newPath,o=n.convertPath(e,"Quantity").newName;break;case"TransactionQuantity"===c:s=n.convertPath(e,"TransactionQuantity").newPath,o=n.convertPath(e,"TransactionQuantity").newName;break;case"TransLineDate"===c:s=n.convertPath(e,"TransLineDate").newPath,o=n.convertPath(e,"TransLineDate").newName;break;case"TransDate"===c:s=n.convertPath(e,"TransDate").newPath,o=n.convertPath(e,"TransDate").newName;break;case"TransactionInvLocation"===c:s=n.convertPath(e,"TransactionInvLocation").newPath,o=n.convertPath(e,"TransactionInvLocation").newName;break;case"UserDefinedClassification"===c:s=n.convertPath(e,"UserDefinedClassification").newPath,o=n.convertPath(e,"UserDefinedClassification").newName;break;case"Remark"===c:s=n.convertPath(e,"Remark").newPath,o=n.convertPath(e,"Remark").newName;break;case"PortInfo"===c:s=n.convertPath(e,"PortInfo").newPath,o=n.convertPath(e,"PortInfo").newName;break;case"Refnum"===c:s=n.convertPath(e,"Refnum").newPath,o=n.convertPath(e,"Refnum").newName;break;case"InvolvedParty"===c:s=n.convertPath(e,"InvolvedParty").newPath,o=n.convertPath(e,"InvolvedParty").newName;break;case"Contact"===c:s=n.convertPath(e,"Contact").newPath,o=n.convertPath(e,"Contact").newName}r[`${c}`]||(r[`${c}`]=[]),r[`${c}`].push({name:a.getElementName(o),path:s}),r[`${c}`]=t.default.uniqBy(r[`${c}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"DV7a":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?e(Object(a),!0).forEach(function(e){r(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=a(e,"string");return"symbol"==typeof t?t:String(t)}function a(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateTrxSchema=void 0;const i=require("./../index"),o=s(require("express")),c=o.default.Router(),u=s(require("path")),l=s(require("fast-xml-parser")),m=s(require("flat")),f=require("../helper/other"),d=require("../helper/Transaction/schemaTransactionProps"),p=require("../models/schemaTransaction");async function g(){const e=u.default.join(i.ROOT_DIR,"XMLs","GtmTransaction.xml"),r=await f.getFileData(e),n=l.default.getTraversalObj(r,{}),a=l.default.convertToJson(n,{}),s=m.default(a),o=d.getChilds(s);let{gtmVersion:c,xmlNsOtm:g,xmlNsGtm:O}=f.getXMlVersion(r);return c||(c=Number(f.CONSTS.GTMVERSION)),new p.SchemaTransaction(t({xmlNs:[g,O],gtmVersion:c},o)).save()}c.post("/",f.asyncRouteHandler(async(e,r)=>{const n=u.default.join(i.ROOT_DIR,"XMLs","GtmTransaction.xml"),a=await f.getFileData(n),s=l.default.getTraversalObj(a,{}),o=l.default.convertToJson(s,{}),c=m.default(o),g=d.getChilds(c),{gtmVersion:O,xmlNsOtm:b,xmlNsGtm:y}=f.getXMlVersion(a);if(!O)return r.status(400).send("XML must contain Namespace");let h=await p.SchemaTransaction.findOne({gtmVersion:O});if(h){if(JSON.stringify(h.GtmTransaction)===JSON.stringify(g.GtmTransaction))return r.status(200).send(h);await p.SchemaTransaction.findByIdAndRemove(h._id)}return h=new p.SchemaTransaction(t({xmlNs:[b,y],gtmVersion:O},g)),h=await h.save(),r.status(200).send(h)})),c.get("/",f.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await p.SchemaTransaction.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await p.SchemaTransaction.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=c,exports.generateTrxSchema=g;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Transaction/schemaTransactionProps":"THe0","../models/schemaTransaction":"Poy0"}],"F2tt":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const a=t(require("express")),n=a.default.Router(),e=require("../helper/other"),r=require("../helper/dbXmlQuery"),s=require("../helper/Transaction/getTransactionData"),i=require("../api/gtm"),d=require("../models/transaction"),u=t(require("../middleware/auth")),o=require("./schemaTransaction");async function c(t,a,n){return await d.Transaction(t,a).find({$or:[{display:n},{disabled:!0}]}).sort({_id:1})}async function l(t,a,n){return t=await d.Transaction(a,n).findByIdAndUpdate(t._id,t,{new:!0})}async function f(t,a){return await d.Transaction(t,a).find({}).sort({_id:1})}function y(t){return{data:t.filter(t=>t.display)}}async function p(t,a,n){return{data:await d.Transaction(t,a).insertMany(n)}}function w(t){return!t||0===t.length}function m(t){return+t.query.gtmVersion||+e.CONSTS.GTMVERSION}function T(t){return t.split(".")[0]}n.get("/",[u.default],e.asyncRouteHandler(async(t,a)=>{const{display:n}=t.query,{username:d,password:u,instance:l,url:_}=t.user,g=T(d);if(n){const t=await c(g,l,n);if(t.length)return a.status(200).json({data:t})}const h=m(t);let q=await s.getTransactionSchema(h);q||(q=await o.generateTrxSchema());const{data:x,error:j}=await e.asyncHandler(i.dbXml(_,r.getTransactionPropsfromGtm,d,u));if(j)return a.status(400).send(j);const b=await s.getTransactionData(q,h,x,g);let I=await f(g,l);return w(I)?a.status(200).json(await p(g,l,b)):(I=await s.getUpdatedProp(b,I,l,g),n?a.status(200).json(y(I)):a.status(200).json({data:I}))})),n.put("/",[u.default],e.asyncRouteHandler(async(t,a)=>{let{transaction:n}=t.body;const{username:e,instance:r}=t.user,s=T(e);return n?(n=await l(n,s,r),a.status(200).json({data:n})):a.status(400).send("Transaction prop value missing!")})),n.put("/swap",[u.default],e.asyncRouteHandler(async(t,a)=>{const{instance:n,username:e}=t.user,r=T(e);let{transactions:s}=t.body;if(!s||0==s.length)return a.status(400).send("Not a valid item list!");s[0]=await d.Transaction(r,n).findByIdAndUpdate({_id:s[0]._id},s[0],{new:!0}).exec(),s[1]=await d.Transaction(r,n).findByIdAndUpdate({_id:s[1]._id},s[1],{new:!0}).exec();let i=await d.Transaction(r,n).find({name:s[1].name}),u=await d.Transaction(r,n).find({name:s[0].name});return i.length>1&&await d.Transaction(r,n).findByIdAndDelete({_id:i[1]._id}).exec(),u.length>1&&await d.Transaction(r,n).findByIdAndDelete({_id:u[1]._id}).exec(),a.status(200).json({data:s})})),exports.default=n;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Transaction/getTransactionData":"ZiiO","../api/gtm":"KJs0","../models/transaction":"fEfK","../middleware/auth":"MNoc","./schemaTransaction":"DV7a"}],"RHAm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OrderBase=void 0;const r=e(require("mongoose")),t=new r.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.OrderBase=((e,a)=>r.default.model("OrderBase",t,`${e}_OrderBase_${a}`));
},{}],"TARO":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaOrderBase=void 0;const r=e(require("mongoose")),t=new r.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},TransOrder:{type:"Mixed"}});exports.SchemaOrderBase=r.default.model("SchemaOrderBase",t,"OrderBaseSchema");
},{}],"cIXx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapItemDescription=exports.mapInvolvedParty=exports.mapItemClassification=exports.mapItemFeature=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),r=["OrderBase ID DomainName","OrderBase ID","OrderBase TransactionCode","Line ID DomainName","Line ID","Line TransactionCode",...Object.values(t.NAME.orderBase).filter(e=>!e.includes("TimeZone"))],p=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}const i=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};exports.mapHeader=((e,t,p,i,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,r),display:a.getMandatoryElement(e.name,r),isMandatory:a.getMandatoryElement(e.name,r),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:p,xmlNs:i})),exports.mapRefnum=((t,r,n,l,s,m,o,d)=>{const u=i(r,"Xid"),h=i(r,"DomainName"),c=i(r,"RefnumValue"),D=i(r,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[c].path,d),path:[{path:r[c].path.replace("INDEX",m),value:""},e.getDomainName(t,r[h].path.replace("INDEX",m)),e.getTC(t,r[D].path.replace("INDEX",m)),e.getXID(t,r[u].path.replace("INDEX",m))],gtmVersion:l,xmlNs:s}}),exports.mapRemark=((t,r,n,l,s,m,o,d)=>{const u=i(r,"Xid"),h=i(r,"DomainName"),c=i(r,"RemarkText"),D=i(r,"RemarkSequence"),g=i(r,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[c].path,d),path:[{path:r[c].path.replace("INDEX",m),value:""},e.getTC(t,r[g].path.replace("INDEX",m)),e.getSequence(t,r[D].path.replace("INDEX",m),m),e.getDomainName(t,r[h].path.replace("INDEX",m)),e.getXID(t,r[u].path.replace("INDEX",m))],gtmVersion:l,xmlNs:s}}),exports.mapItemFeature=((t,r,n,l,s,m,o,d)=>{const u=i(r,"Xid"),h=i(r,"DomainName"),c=i(r,"ItemFeatureValue"),D=i(r,"TransactionCode");return{name:`${o} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[c].path,d),path:[{path:r[c].path,value:""},e.getDomainName(t,r[h].path),e.getTC(t,r[D].path),e.getXID(t,r[u].path)],gtmVersion:l,xmlNs:s}}),exports.mapItemClassification=((t,r,p,n,l,s,m)=>{const o=i(r,"Xid"),d=i(r,"ClassificationCode"),u=i(r,"TransactionCode");return{name:`${t}`,required:!0,disabled:!1,display:!1,type:p,displayText:`${t}`,defaultValue:a.getDefaultValue(r[d].path,m),path:[{path:r[d].path,value:""},e.getTC(t,r[u].path),e.getXID(t,r[o].path)],gtmVersion:n,xmlNs:l}}),exports.mapInvolvedParty=((t,r,n,l,s,m,o,d="")=>{const u=i(r,/InvolvedPartyQualifierGid(.*?)Xid/),h=i(r,/ContactGid(.*?)Xid/),c=i(r,/ContactGid(.*?)DomainName/),D=i(r,"TransactionCode");return{name:`${o} ${t} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${o} ${p(0,0,t)} Contact ID`.trim(),defaultValue:a.getDefaultValue(r[h].path,d),path:[{path:r[h].path,value:""},e.getTC(t,r[D].path),{path:r[c].path,value:d},e.getXID(t,r[u].path)],gtmVersion:l,xmlNs:s}}),exports.mapItemDescription=((t,r,p,n,l,s,m)=>{const o=i(r,"Xid"),d=i(r,"DomainName"),u=i(r,":Description"),h=i(r,"SequenceNumber"),c=i(r,"TransactionCode");return{name:`Description in ${t.split("::")[1]}`,required:!0,disabled:!1,display:!1,type:p,displayText:`Description in ${t.split("::")[1]}`,defaultValue:a.getDefaultValue(r[u].path,m),path:[{path:r[u].path,value:""},e.getTC(t.split("::")[0],r[c].path),e.getSequence(t.split("::")[0],r[h].path,s),e.getDomainName(t.split("::")[0],r[d].path),e.getXID(t.split("::")[0],r[o].path)],gtmVersion:n,xmlNs:l}});
},{"../other":"irtd","../renamer":"jN2X"}],"BAB7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getOrderBaseData=exports.getOrderBaseSchema=void 0;const r=e(require("lodash")),a=e(require("promise-memoize")),t=require("../../models/orderBase"),n=require("../../models/schemaOrderBase"),s=require("./orderBaseProps");function d(e,a,t,n){return new Promise(function(d){let{Header:m,Remark:i,Refnum:o}=e.TransOrder.OrderBase,{Header:u,Remark:p,Refnum:f}=e.TransOrder.OrderBaseLine;const c=e.xmlNs;m=m.map(e=>s.mapHeader(e,"Order Base : Header",a,c,n)),u=u.map(e=>s.mapHeader(e,"Order Base Line : Header",a,c,n));const l=t.match(/REMARKS="(.*?)"/)[1].split(",");i=l.map((e,r)=>s.mapRemark(e,i,"Order Base : Remark",a,c,r,"",n)),p=l.map((e,r)=>s.mapRemark(e,p,"Order Base Line : Remark",a,c,r,"Line",n));const O=t.match(/REFNUMS="(.*?)"/)[1].split(",");o=O.map((e,r)=>s.mapRefnum(e,o,"Order Base : Refnum",a,c,r,"",n));const B=t.match(/LINE_REFNUMS="(.*?)"/)[1].split(",");f=B.map((e,r)=>s.mapRefnum(e,f,"Order Base Line : Refnum",a,c,r,"Line",n)),d(r.default.uniqBy([...m,...i,...o,...u,...p,...f],e=>e.name))})}function m(e,a,n,s){return new Promise(async function(d){const m=r.default.differenceWith(e,a,(e,r)=>e.name===r.name),i=r.default.differenceWith(a,e,(e,r)=>e.name===r.name);if(m.length>0){const e=await t.OrderBase(s,n).insertMany(m);d([...a,...e])}else i.length>0?(await t.OrderBase(s,n).deleteMany({_id:{$in:[...i.map(e=>e._id)]}}),d(r.default.differenceWith(a,i,(e,r)=>e.name===r.name))):d(a)})}function i(e){return n.SchemaOrderBase.findOne({gtmVersion:e}).sort({_id:1})}exports.getOrderBaseSchema=a.default(i,{maxAge:6e4}),exports.getOrderBaseData=a.default(d,{maxAge:6e4}),exports.getUpdatedProp=a.default(m,{maxAge:6e4});
},{"../../models/orderBase":"RHAm","../../models/schemaOrderBase":"TARO","./orderBaseProps":"cIXx"}],"Xt3B":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("express")),t=r.default.Router(),a=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/OrderBase/getOrderBaseData"),d=require("../api/gtm"),i=require("../models/orderBase"),u=e(require("../middleware/auth"));function o(e){return e.query.gtmVersion?+e.query.gtmVersion:+a.CONSTS.GTMVERSION}t.get("/",[u.default],a.asyncRouteHandler(async(e,r)=>{const{display:t}=e.query,{username:u,password:l,instance:c,url:p}=e.user,f=u.split(".")[0];if(t){const e=await i.OrderBase(f,c).find({$or:[{display:t},{disabled:!0}]}).sort({_id:1});if(e.length)return r.status(200).json({data:e})}const m=o(e),y=await n.getOrderBaseSchema(m);if(!y)return r.status(400).send(`gtmVersion:${m} schema not available!`);const{data:B,error:O}=await a.asyncHandler(d.dbXml(p,s.getOrderBasePropsfromGtm,u,l));if(O)return r.status(400).send(O);const g=await n.getOrderBaseData(y,m,B,f),h=await i.OrderBase(f,c).find({}).sort({_id:1});return h&&0!==h.length?t?r.status(200).json({data:h.filter(e=>e.display)}):r.status(200).json({data:h}):r.status(200).json({data:await i.OrderBase(f,c).insertMany(g)})})),t.put("/",[u.default],a.asyncRouteHandler(async(e,r)=>{let{orderBase:t}=e.body;const{username:a,instance:s}=e.user,n=a.split(".")[0];return t?(t=await i.OrderBase(n,s).findByIdAndUpdate(t._id,t,{new:!0}),r.status(200).json({data:t})):r.status(400).send("OrderBase prop value missing!")})),exports.default=t;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/OrderBase/getOrderBaseData":"BAB7","../api/gtm":"KJs0","../models/orderBase":"RHAm","../middleware/auth":"MNoc"}],"k9TE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const r=require("../renamer"),t=e(require("lodash")),a=require("../other"),s=e=>{const r={};return t.default.keys(e).map(e=>n(e,r)).filter(e=>void 0!==e),r},n=(e,r)=>{switch(!0){case-1!==e.search("InvolvedParty"):d(e,r,"InvolvedParty");break;case-1!==e.search("Remark"):d(e,r,"Remark");break;case-1!==e.search("ItemAttributes"):d(e,r,"ItemAttributes");break;case-1!==e.search("Refnum"):d(e,r,"Refnum");break;default:d(e,r,"Header")}return r};exports.getChilds=(e=>{const r={OrderBase:{},OrderBaseLine:{}};return t.default.keys(e).map(t=>{switch(!0){case-1===t.search("TransOrder"):break;case-1!==t.search("TransOrderLineDetail"):c(t,e,r,"OrderBaseLine");break;default:c(t,e,r,"OrderBase")}return r}).filter(e=>void 0!==e),r.OrderBase=s(r.OrderBase),r.OrderBaseLine=s(r.OrderBaseLine),{TransOrder:r}});const c=(e,r,t,a)=>{t[`${a}`][`${e}`]=r[`${e}`]},d=(e,s,n)=>{let c=e,d=e;switch(!0){case"Remark"===n:c=a.convertPath(e,"Remark").newPath,d=a.convertPath(e,"Remark").newName;break;case"InvolvedParty"===n:c=a.convertPath(e,"InvolvedParty").newPath,d=a.convertPath(e,"InvolvedParty").newName;break;case"Refnum"===n:c=a.convertPath(e,"Refnum").newPath,d=a.convertPath(e,"Refnum").newName;break;case"ItemAttributes"===n:c=a.convertPath(e,"ItemAttributes").newPath,d=a.convertPath(e,"ItemAttributes").newName}s[`${n}`]||(s[`${n}`]=[]),s[`${n}`].push({name:r.getElementName(d),path:c}),s[`${n}`]=t.default.uniqBy(s[`${n}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"KJCd":[function(require,module,exports) {
"use strict";function e(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function r(r){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?e(Object(s),!0).forEach(function(e){t(r,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(s,e))})}return r}function t(e,r,t){return(r=n(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(e){var r=s(e,"string");return"symbol"==typeof r?r:String(r)}function s(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("./../index"),o=a(require("express")),u=o.default.Router(),c=a(require("path")),l=a(require("fast-xml-parser")),f=a(require("flat")),d=require("../helper/other"),m=require("../helper/OrderBase/schemaOrderBaseProps"),O=require("../models/schemaOrderBase");u.post("/",d.asyncRouteHandler(async(e,t)=>{const n=c.default.join(i.ROOT_DIR,"XMLs","OrderBase.xml"),s=await d.getFileData(n),a=l.default.getTraversalObj(s,{}),o=l.default.convertToJson(a,{}),u=f.default(o),p=m.getChilds(u),{gtmVersion:y,xmlNsOtm:b,xmlNsGtm:g}=d.getXMlVersion(s);if(!y)return t.status(400).send("XML must contain Namespace");let h=await O.SchemaOrderBase.findOne({gtmVersion:y});if(h){if(JSON.stringify(h.TransOrder)===JSON.stringify(p.TransOrder))return t.status(200).send(h);await O.SchemaOrderBase.findByIdAndRemove(h._id)}return h=new O.SchemaOrderBase(r({xmlNs:[b,g],gtmVersion:y},p)),h=await h.save(),t.status(200).send(h)})),u.get("/",d.asyncRouteHandler(async(e,r)=>{const{gtmVersion:t}=e.query;if(!t){const e=await O.SchemaOrderBase.find().sort({gtmVersion:-1});return r.status(200).send(e)}const n=await O.SchemaOrderBase.findOne({gtmVersion:t});return n?r.status(200).send(n):r.status(400).send(`gtmVersion:${t} schema not available!`)})),exports.default=u;
},{"./../index":"Focm","../helper/other":"irtd","../helper/OrderBase/schemaOrderBaseProps":"k9TE","../models/schemaOrderBase":"TARO"}],"OHIs":[function(require,module,exports) {
"use strict";function e(e,s,t){if(!e.user.isAdmin)return s.status(403).send("Access denied.");t()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"YYHk":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var i={};if(null!=n)for(var a in n)"default"!==a&&Object.hasOwnProperty.call(n,a)&&e(i,n,a);return t(i,n),i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=i(require("express")),s=a.default.Router(),r=i(require("fs")),u=i(require("path")),d=n(require("fs-extra")),l=require("util"),f=l.promisify(r.default.readFile),o=l.promisify(r.default.writeFile),c=i(require("multiparty")),_=i(require("../middleware/auth")),m=i(require("../middleware/admin")),y=require("../models/setting"),j=require("../helper/other");async function v(e,t){const n=await f(e);await o(t,n)}s.get("/",[_.default,m.default],j.asyncRouteHandler(async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0];r.default.readdir(u.default.join(__dirname,"..","csv",i,a),async(e,n)=>{const s=[];if(e)return!r.default.existsSync(u.default.join(__dirname,"..","csv"))&&r.default.mkdirSync(u.default.join(__dirname,"..","csv")),!r.default.existsSync(u.default.join(__dirname,"..","csv",i))&&r.default.mkdirSync(u.default.join(__dirname,"..","csv",i)),!r.default.existsSync(u.default.join(__dirname,"..","csv",i,a))&&r.default.mkdirSync(u.default.join(__dirname,"..","csv",i,a)),t.status(200).json({data:{files:[]}});for(let t=0;t<n.length;t++){const e=n[t].toString().split("$$$");s.push({id:t+1,uploaduser:e[0],userrole:e[1],uploaddate:e[2],filename:e[3]})}const d=await y.Setting(i).findOne();return t.status(200).json({data:{files:s,setting:d}})})})),s.post("/",[_.default],j.asyncRouteHandler(async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0];(new c.default.Form).parse(e,function(e,n,s){const d=s[Object.keys(s)[0]][0].fieldName;d||t.status(400).json("FileName not provided!");const l=s[Object.keys(s)[0]][0].path;return r.default.existsSync(u.default.join(__dirname,"..","csv"))||r.default.mkdirSync(u.default.join(__dirname,"..","csv")),r.default.existsSync(u.default.join(__dirname,"..","csv",i))||r.default.mkdirSync(u.default.join(__dirname,"..","csv",i)),r.default.existsSync(u.default.join(__dirname,"..","csv",i,a))||r.default.mkdirSync(u.default.join(__dirname,"..","csv",i,a)),v(l,u.default.join(__dirname,"..","csv",i,a,d)),t.status(200).json({data:"CSV saved to server."})})})),s.get("/files",[_.default,m.default],j.asyncRouteHandler(async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0],s=e.query.file;r.default.exists(u.default.join(__dirname,"..","csv",i,a,s),function(e){if(!e)return t.status(404).end(`File ${s} not found!`);r.default.readFile(u.default.join(__dirname,"..","csv",i,a,s),function(e,n){return e?t.status(500).end(`Error getting the file: ${e}.`):t.send(n.toString("UTF-8"))})})})),s.delete("/files",[_.default,m.default],async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0],s=e.query.file;r.default.exists(u.default.join(__dirname,"..","csv",i,a,s),function(e){if(!e)return t.status(404).end(`File ${s} not found!`);r.default.unlink(u.default.join(__dirname,"..","csv",i,a,s),function(e){return e?t.status(500).end(`Error deleting the file: ${e}.`):t.send({data:{success:!0}})})})}),s.delete("/files/all",[_.default,m.default],async(e,t)=>{const{username:n,instance:i}=e.user,a=n.split(".")[0];d.exists(u.default.join(__dirname,"..","csv",i,a),function(e){if(!e)return t.status(404).end("Files not found!");d.remove(u.default.join(__dirname,"..","csv",i,a),function(e){return e?t.status(500).end(`Error deleting the file: ${e}.`):t.send({data:{success:!0}})})})}),exports.default=s;
},{"../middleware/auth":"MNoc","../middleware/admin":"OHIs","../models/setting":"IMRL","../helper/other":"irtd"}],"UddP":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),r=require("../helper/other"),s=require("../models/setting"),n=e(require("../middleware/auth"));a.get("/",[n.default],r.asyncRouteHandler(async(e,t)=>{const{instance:a,url:n}=e.user;let u=await s.Setting(a).findOne();return u?t.status(200).json({data:u}):(u=await s.Setting(a).create({url:n,version:+r.CONSTS.GTMVERSION}),t.status(200).json({data:u}))})),a.put("/",[n.default],r.asyncRouteHandler(async(e,t)=>{const{instance:a}=e.user;let{setting:r}=e.body;return r=await s.Setting(a).findByIdAndUpdate(r._id,r,{new:!0}),t.status(200).json({data:r})})),exports.default=a;
},{"../helper/other":"irtd","../models/setting":"IMRL","../middleware/auth":"MNoc"}],"Ytvl":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TrackingEvent=void 0;const t=e(require("mongoose")),n=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.TrackingEvent=((e,r)=>t.default.model("TrackingEvent",n,`${e}_TrackingEvent_${r}`));
},{}],"bLgw":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaTrackingEvent=void 0;const t=e(require("mongoose")),r=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ShipmentStatus:{type:"Mixed"}});exports.SchemaTrackingEvent=t.default.model("SchemaTrackingEvent",r,"TrackingEventSchema");
},{}],"sUtY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=["Status Code ID","Status Code ID DomainName","Stop Sequence Num","Time Zone ID","Log Date","Responsible Party ID DomainName","Responsible Party ID"],p=(a,t,p)=>{const r=e.capitalize(p.split("_").join(" "));return r.split(".")[1]?r.split(".")[1]:r},r=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};exports.mapHeader=((e,p,r,n,s)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,t),display:a.getMandatoryElement(e.name,t),type:p,displayText:e.name,defaultValue:a.getDefaultValue(e.path,s),path:[e.path],gtmVersion:r,xmlNs:n})),exports.mapRefnum=((t,i,o,l,m,u,d)=>{const D=r(i,"Xid"),h=r(i,"DomainName"),c=r(i,"ShipmentRefnumValue"),I=r(i,"TransactionCode");return{name:n(t),required:!0,disabled:s(t),display:s(t),type:o,displayText:n(p(0,0,t)),defaultValue:a.getDefaultValue(i[c].path,d),path:[{path:i[c].path.replace("INDEX",u),value:""},e.getDomainName(t,i[h].path.replace("INDEX",u)),e.getTC(t,i[I].path.replace("INDEX",u)),e.getXID(t,i[D].path.replace("INDEX",u))],gtmVersion:l,xmlNs:m}});const n=e=>"GLOG"===e.toUpperCase()?"Shipment ID":e,s=e=>"GLOG"===e.toUpperCase();
},{"../other":"irtd","../renamer":"jN2X"}],"GO0I":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getTrackingEventData=exports.getTrackingEventSchema=void 0;const t=e(require("lodash")),n=e(require("promise-memoize")),a=require("../../models/trackingEvent"),r=require("../../models/schemaTrackingEvent"),i=require("./trackingEventProps");function o(e,n,a,r){return new Promise(function(o){let{Header:c,Refnum:m}=e.ShipmentStatus;const s=e.xmlNs;c=c.map(e=>i.mapHeader(e,"TrackingEvent : Header",n,s,r));const u=a.match(/REFNUMS="(.*?)"/)[1].split(",");m=u.map((e,t)=>i.mapRefnum(e,m,"TrackingEvent : Refnum",n,s,t,r)),o(t.default.uniqBy([...c,...m],e=>e.name))})}function c(e,n,r,i){return new Promise(async function(o){const c=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),m=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(c.length>0){const e=await a.TrackingEvent(i,r).insertMany(c);o([...n,...e])}else m.length>0?(await a.TrackingEvent(i,r).deleteMany({_id:{$in:[...m.map(e=>e._id)]}}),o(t.default.differenceWith(n,m,(e,t)=>e.name===t.name))):o(n)})}function m(e){return r.SchemaTrackingEvent.findOne({gtmVersion:e}).sort({_id:1})}exports.getTrackingEventSchema=n.default(m,{maxAge:6e4}),exports.getTrackingEventData=n.default(o,{maxAge:6e4}),exports.getUpdatedProp=n.default(c,{maxAge:6e4});
},{"../../models/trackingEvent":"Ytvl","../../models/schemaTrackingEvent":"bLgw","./trackingEventProps":"sUtY"}],"J2kM":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("express")),a=e.default.Router(),r=require("../helper/other"),n=require("../helper/dbXmlQuery"),s=require("../helper/TrackingEvent/getTrackingEventData"),i=require("../api/gtm"),u=require("../models/trackingEvent"),d=t(require("../middleware/auth"));a.get("/",[d.default],r.asyncRouteHandler(async(t,e)=>{const{display:a}=t.query,{username:d,password:o,instance:l,url:c}=t.user,g=d.split(".")[0];if(a){const t=await u.TrackingEvent(g,l).find({$or:[{display:a},{disabled:!0}]}).sort({_id:1});if(t.length)return e.status(200).json({data:t})}const p=+t.query.gtmVersion||+r.CONSTS.GTMVERSION,f=await s.getTrackingEventSchema(p);if(!f)return e.status(400).send(`gtmVersion:${p} schema not available!`);const{data:v,error:m}=await r.asyncHandler(i.dbXml(c,n.getTrackingEventPropfromOtm,d,o));if(m)return e.status(400).send(m);const y=await s.getTrackingEventData(f,p,v);let E=await u.TrackingEvent(g,l).find({}).sort({_id:1});return E&&0!==E.length?(E=await s.getUpdatedProp(y,E,l,g),a?e.status(200).json({data:E.filter(t=>t.display)}):e.status(200).json({data:E})):e.status(200).json({data:await u.TrackingEvent(g,l).insertMany(y)})})),a.put("/",[d.default],r.asyncRouteHandler(async(t,e)=>{const{instance:a,username:r}=t.user,n=r.split(".")[0];let{trackingEvent:s}=t.body;return s?(s=await u.TrackingEvent(n,a).findByIdAndUpdate(s._id,s,{new:!0}),e.status(200).json({data:s})):e.status(400).send("Tracking Event prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/TrackingEvent/getTrackingEventData":"GO0I","../api/gtm":"KJs0","../models/trackingEvent":"Ytvl","../middleware/auth":"MNoc"}],"e4o2":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),a=e(require("lodash")),r=require("../other"),s=e=>{const t={};return a.default.keys(e).map(e=>u(e,t)).filter(e=>void 0!==e),t},u=(e,t)=>{switch(!0){case-1!==e.search("Refnum"):i(e,t,"Refnum");break;default:i(e,t,"Header")}return t};exports.getChilds=(e=>{const t={ShipmentStatus:{}};return a.default.keys(e).map(a=>{switch(!0){case-1===a.search("ShipmentStatus"):break;default:n(a,e,t,"ShipmentStatus")}return t}).filter(e=>void 0!==e),t.ShipmentStatus=s(t.ShipmentStatus),{ShipmentStatus:t.ShipmentStatus}});const n=(e,t,a,r)=>{a[`${r}`][`${e}`]=t[`${e}`]},i=(e,s,u)=>{let n=e,i=e;switch(!0){case"Refnum"===u:n=r.convertPath(e,"Refnum").newPath,i=r.convertPath(e,"Refnum").newName}s[`${u}`]||(s[`${u}`]=[]),s[`${u}`].push({name:t.getElementName(i),path:n}),s[`${u}`]=a.default.uniqBy(s[`${u}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"WFgW":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=i(e,"string");return"symbol"==typeof t?t:String(t)}function i(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("./../index"),o=a(require("express")),u=o.default.Router(),c=a(require("path")),l=a(require("fast-xml-parser")),f=a(require("flat")),m=require("../helper/other"),g=require("../helper/TrackingEvent/schemaTrackingEventProps"),p=require("../models/schemaTrackingEvent");u.post("/",m.asyncRouteHandler(async(e,r)=>{const n=c.default.join(s.ROOT_DIR,"XMLs","TrackingEvent.xml"),i=await m.getFileData(n),a=l.default.getTraversalObj(i,{}),o=l.default.convertToJson(a,{}),u=f.default(o),d=g.getChilds(u),{gtmVersion:v,xmlNsOtm:y,xmlNsGtm:O}=m.getXMlVersion(i);if(!v)return r.status(400).send("XML must contain Namespace");let b=await p.SchemaTrackingEvent.findOne({gtmVersion:v});if(b){if(JSON.stringify(b.ShipmentStatus)===JSON.stringify(d.ShipmentStatus))return r.status(200).send(b);await p.SchemaTrackingEvent.findByIdAndRemove(b._id)}return b=new p.SchemaTrackingEvent(t({xmlNs:[y,O],gtmVersion:v},d)),b=await b.save(),r.status(200).send(b)})),u.get("/",m.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await p.SchemaTrackingEvent.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await p.SchemaTrackingEvent.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=u;
},{"./../index":"Focm","../helper/other":"irtd","../helper/TrackingEvent/schemaTrackingEventProps":"e4o2","../models/schemaTrackingEvent":"bLgw"}],"RymQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Shipment=void 0;const t=e(require("mongoose")),i=new t.default.Schema({name:String,required:Boolean,disabled:Boolean,display:Boolean,isMandatory:Boolean,type:String,displayText:String,defaultValue:String,gtmVersion:Number,xmlNs:["String"],path:["Mixed"]});exports.Shipment=((e,o)=>t.default.model("Shipment",i,`${e}_Shipment_${o}`));
},{}],"Tn9S":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaShipment=void 0;const t=e(require("mongoose")),i=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},ActualShipment:{type:"Mixed"}});exports.SchemaShipment=t.default.model("SchemaShipment",i,"ShipmentSchema");
},{}],"TZ3U":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),p=["Shipment ID DomainName","Shipment ID","Shipment TransactionCode","Transport Mode ID","Stop Sequence","Location ID DomainName","Location ID","Activity","ShipUnit ID","ShipUnit ID DomainName",...Object.values(t.NAME.shipment)],r=(a,t,p)=>{const r=e.capitalize(p.split("_").join(" "));return r.split(".")[1]?r.split(".")[1]:r},n=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let i=0;i<e.getSequence.length;i++){e.getSequence[i]}exports.mapHeader=((e,t,r,n,i)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,p),display:a.getMandatoryElement(e.name,p),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,i),path:[e.path],gtmVersion:r,xmlNs:n})),exports.mapRefnum=((t,p,i,l,m,o,s)=>{const u=n(p,"Xid"),d=n(p,"DomainName"),c=n(p,"RefnumValue"),h=n(p,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:i,displayText:r(0,0,t),defaultValue:a.getDefaultValue(p[c].path,s),path:[{path:p[c].path.replace("INDEX",o),value:""},e.getDomainName(t,p[d].path.replace("INDEX",o)),e.getTC(t,p[h].path.replace("INDEX",o)),e.getXID(t,p[u].path.replace("INDEX",o))],gtmVersion:l,xmlNs:m}}),exports.mapRemark=((t,p,i,l,m,o,s)=>{const u=n(p,"Xid"),d=n(p,"DomainName"),c=n(p,"RemarkText"),h=n(p,"RemarkSequence"),D=n(p,"TransactionCode");return{name:t,required:!0,disabled:!1,display:!1,type:i,displayText:r(0,0,t),defaultValue:a.getDefaultValue(p[c].path,s),path:[{path:p[c].path.replace("INDEX",o),value:""},e.getTC(t,p[D].path.replace("INDEX",o)),e.getSequence(t,p[h].path.replace("INDEX",o),o),e.getDomainName(t,p[d].path.replace("INDEX",o)),e.getXID(t,p[u].path.replace("INDEX",o))],gtmVersion:l,xmlNs:m}});
},{"../other":"irtd","../renamer":"jN2X"}],"MdE1":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getShipmentData=exports.getShipmentSchema=void 0;const t=e(require("lodash")),n=e(require("promise-memoize")),a=require("../../models/shipment"),i=require("../../models/schemaShipment"),m=require("./shipmentProps");function r(e,n,a,i){return new Promise(function(r){let{Header:p,Remark:o,Refnum:s}=e.ActualShipment.Shipment,{Header:d}=e.ActualShipment.ShipmentStop,{Header:h}=e.ActualShipment.ShipUnit;const u=e.xmlNs;p=p.map(e=>m.mapHeader(e,"Shipment : Header",n,u,i)),d=d.map(e=>m.mapHeader(e,"Shipment Stop : Header",n,u,i)),h=h.map(e=>m.mapHeader(e,"ShipUnit : Header",n,u,i));const c=a.match(/REMARKS="(.*?)"/)[1].split(",");o=c.map((e,t)=>m.mapRemark(e,o,"Shipment : Remark",n,u,t,i));const f=a.match(/SHIPMENT_REFNUMS="(.*?)"/)[1].split(",");s=f.map((e,t)=>m.mapRefnum(e,s,"Shipment : Refnum",n,u,t,i)),r(t.default.uniqBy([...p,...o,...s,...d,...h],e=>e.name))})}function p(e,n,i,m){return new Promise(async function(r){const p=t.default.differenceWith(e,n,(e,t)=>e.name===t.name),o=t.default.differenceWith(n,e,(e,t)=>e.name===t.name);if(p.length>0){const e=await a.Shipment(m,i).insertMany(p);r([...n,...e])}else o.length>0?(await a.Shipment(m,i).deleteMany({_id:{$in:[...o.map(e=>e._id)]}}),r(t.default.differenceWith(n,o,(e,t)=>e.name===t.name))):r(n)})}function o(e){return i.SchemaShipment.findOne({gtmVersion:e}).sort({_id:1})}exports.getShipmentSchema=n.default(o,{maxAge:6e4}),exports.getShipmentData=n.default(r,{maxAge:6e4}),exports.getUpdatedProp=n.default(p,{maxAge:6e4});
},{"../../models/shipment":"RymQ","../../models/schemaShipment":"Tn9S","./shipmentProps":"TZ3U"}],"Dxzj":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),s=require("../helper/other"),r=require("../helper/dbXmlQuery"),n=require("../helper/Shipment/getShipmentData"),i=require("../api/gtm"),u=require("../models/shipment"),d=e(require("../middleware/auth"));a.get("/",[d.default],s.asyncRouteHandler(async(e,t)=>{const{display:a}=e.query,{username:d,password:o,instance:l,url:p}=e.user,m=d.split(".")[0];if(a){const e=await u.Shipment(m,l).find({$or:[{display:a},{disabled:!0}]}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const h=+e.query.gtmVersion||+s.CONSTS.GTMVERSION,c=await n.getShipmentSchema(h);if(!c)return t.status(400).send(`gtmVersion:${h} schema not available!`);const{data:f,error:y}=await s.asyncHandler(i.dbXml(p,r.getShipmentPropsfromGtm,d,o));if(y)return t.status(400).send(y);const S=await n.getShipmentData(c,h,f,m),g=await u.Shipment(m,l).find({}).sort({_id:1});return g&&0!==g.length?a?t.status(200).json({data:g.filter(e=>e.display)}):t.status(200).json({data:g}):t.status(200).json({data:await u.Shipment(m,l).insertMany(S)})})),a.put("/",[d.default],s.asyncRouteHandler(async(e,t)=>{let{shipment:a}=e.body;const{username:s,instance:r}=e.user,n=s.split(".")[0];return a?(a=await u.Shipment(n,r).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Shipment prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Shipment/getShipmentData":"MdE1","../api/gtm":"KJs0","../models/shipment":"RymQ","../middleware/auth":"MNoc"}],"IbzE":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=i(e,"string");return"symbol"==typeof t?t:String(t)}function i(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const o=require("../renamer"),p=a(require("lodash")),c=require("../other"),u=e=>{const t={};return p.default.keys(e).map(e=>h(e,t)).filter(e=>void 0!==e),t},h=(e,t)=>{switch(!0){case-1!==e.search("Remark"):m(e,t,"Remark");break;case-1!==e.search("Refnum"):m(e,t,"Refnum");break;default:m(e,t,"Header")}return t};exports.getChilds=(e=>{const r={Shipment:{},ShipmentStop:{},ShipUnit:{}};return p.default.keys(e).map(t=>{switch(!0){case-1===t.search("ActualShipment"):break;case-1!==t.search("ShipmentStop"):s(t,e,r,"ShipmentStop");break;case-1!==t.search("ShipUnit"):s(t,e,r,"ShipUnit");break;default:s(t,e,r,"Shipment")}return r}).filter(e=>void 0!==e),r.Shipment=u(r.Shipment),r.ShipmentStop=u(r.ShipmentStop),r.ShipUnit=u(r.ShipUnit),r.Shipment.ShipmentStop=t({},r.ShipmentStop),r.Shipment.ShipUnit=t({},r.ShipUnit),{ActualShipment:r}});const s=(e,t,r,n)=>{r[`${n}`][`${e}`]=t[`${e}`]},m=(e,t,r)=>{let n=e,i=e;switch(!0){case"Remark"===r:n=c.convertPath(e,"Remark").newPath,i=c.convertPath(e,"Remark").newName;break;case"Refnum"===r:n=c.convertPath(e,"Refnum").newPath,i=c.convertPath(e,"Refnum").newName}t[`${r}`]||(t[`${r}`]=[]),t[`${r}`].push({name:o.getElementName(i),path:n}),t[`${r}`]=p.default.uniqBy(t[`${r}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"oS06":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=i(e,"string");return"symbol"==typeof t?t:String(t)}function i(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=require("./../index"),o=s(require("express")),u=o.default.Router(),c=s(require("path")),l=s(require("fast-xml-parser")),m=s(require("flat")),f=require("../helper/other"),p=require("../helper/Shipment/schemaShipmentProps"),d=require("../models/schemaShipment");u.post("/",f.asyncRouteHandler(async(e,r)=>{const n=c.default.join(a.ROOT_DIR,"XMLs","ActualShipment.xml"),i=await f.getFileData(n),s=l.default.getTraversalObj(i,{}),o=l.default.convertToJson(s,{}),u=m.default(o),h=p.getChilds(u),{gtmVersion:y,xmlNsOtm:O,xmlNsGtm:b}=f.getXMlVersion(i);if(!y)return r.status(400).send("XML must contain Namespace");let g=await d.SchemaShipment.findOne({gtmVersion:y});if(g){if(JSON.stringify(g.ActualShipment)===JSON.stringify(h.ActualShipment))return r.status(200).send(g);await d.SchemaShipment.findByIdAndRemove(g._id)}return g=new d.SchemaShipment(t({xmlNs:[O,b],gtmVersion:y},h)),g=await g.save(),r.status(200).send(g)})),u.get("/",f.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await d.SchemaShipment.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await d.SchemaShipment.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=u;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Shipment/schemaShipmentProps":"IbzE","../models/schemaShipment":"Tn9S"}],"yqlE":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bom=void 0;const t=e(require("mongoose")),o=new t.default.Schema({name:{type:"String"},required:{type:"Boolean"},disabled:{type:"Boolean"},display:{type:"Boolean"},type:{type:"String"},displayText:{type:"String"},defaultValue:{type:"String"},path:{type:["Mixed"]},xmlNs:{type:["String"]},gtmVersion:{type:"Number"}});exports.Bom=((e,r)=>t.default.model("Bom",o,`${e}_Bom_${r}`));
},{}],"fhQn":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SchemaBom=void 0;const t=e(require("mongoose")),o=new t.default.Schema({xmlNs:{type:["String"]},gtmVersion:{type:"Number"},Bom:{type:"Mixed"}});exports.SchemaBom=t.default.model("SchemaBom",o,"BomSchema");
},{}],"d1Ga":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapInvolvedParty=exports.mapRemark=exports.mapRefnum=exports.mapHeader=void 0;const e=require("../other"),a=require("../renamer"),t=require("../other"),r=["Bom TransactionCode","Bom ID DomainName","Bom ID","Item ID DomainName","Item ID",...Object.values(t.NAME.bom)],p=(a,t,r)=>{const p=e.capitalize(r.split("_").join(" "));return p.split(".")[1]?p.split(".")[1]:p},l=(e,a)=>{return e.findIndex(e=>e.path.search(a)>-1)};for(let n=0;n<e.getSequence.length;n++){e.getSequence[n]}exports.mapHeader=((e,t,p,l,n)=>({name:e.name,required:!0,disabled:a.getMandatoryElement(e.name,r),display:a.getMandatoryElement(e.name,r),type:t,displayText:e.name,defaultValue:a.getDefaultValue(e.path,n),path:[e.path],gtmVersion:p,xmlNs:l})),exports.mapRefnum=((t,r,n,m,i,o,d,s)=>{const u=l(r,"Xid"),c=l(r,"DomainName"),h=l(r,"RefnumValue"),D=l(r,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${d} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[h].path,s),path:[{path:r[h].path.replace("INDEX",o),value:""},e.getDomainName(t,r[c].path.replace("INDEX",o)),e.getTC(t,r[D].path.replace("INDEX",o)),e.getXID(t,r[u].path.replace("INDEX",o))],gtmVersion:m,xmlNs:i}}),exports.mapRemark=((t,r,n,m,i,o,d,s)=>{const u=l(r,"Xid"),c=l(r,"DomainName"),h=l(r,"RemarkText"),D=l(r,"RemarkSequence"),I=l(r,"TransactionCode");return{name:`${d} ${t}`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${d} ${p(0,0,t)}`.trim(),defaultValue:a.getDefaultValue(r[h].path,s),path:[{path:r[h].path.replace("INDEX",o),value:""},e.getTC(t,r[I].path.replace("INDEX",o)),e.getSequence(t,r[D].path.replace("INDEX",o),o),e.getDomainName(t,r[c].path.replace("INDEX",o)),e.getXID(t,r[u].path.replace("INDEX",o))],gtmVersion:m,xmlNs:i}}),exports.mapInvolvedParty=((t,r,n,m,i,o,d,s="")=>{const u=l(r,/InvolvedPartyQualifierGid(.*?)Xid/),c=l(r,/ContactGid(.*?)Xid/),h=l(r,/ContactGid(.*?)DomainName/),D=l(r,"TransactionCode");return{name:`${d} ${t} Contact ID`.trim(),required:!0,disabled:!1,display:!1,type:n,displayText:`${d} ${p(0,0,t)} Contact ID`.trim(),defaultValue:a.getDefaultValue(r[c].path,s),path:[{path:r[c].path,value:""},e.getTC(t,r[D].path),{path:r[h].path,value:s},e.getXID(t,r[u].path)],gtmVersion:m,xmlNs:i}});
},{"../other":"irtd","../renamer":"jN2X"}],"KGb3":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUpdatedProp=exports.getBomData=exports.getBomSchema=void 0;const m=e(require("lodash")),t=e(require("promise-memoize")),o=require("../../models/bom"),a=require("../../models/schemaBom"),n=require("./bomProps");function r(e,t,o,a){return new Promise(function(r){let{Header:i,Remark:p,Refnum:s,InvolvedParty:d}=e.Bom.Bom,{Header:u,Remark:f,Refnum:c}=e.Bom.BomComponent;const l=e.xmlNs;i=i.map(e=>n.mapHeader(e,"Bom : Header",t,l,a)),u=u.map(e=>n.mapHeader(e,"Bom Component : Header",t,l,a));const B=o.match(/REMARKS="(.*?)"/)[1].split(",");p=B.map((e,m)=>n.mapRemark(e,p,"Bom : Remark",t,l,m,"",a)),f=B.map((e,m)=>n.mapRemark(e,f,"Bom Component : Remark",t,l,m,"Component",a));const R=o.match(/REFNUMS="(.*?)"/)[1].split(",");s=R.map((e,m)=>n.mapRefnum(e,s,"Bom : Refnum",t,l,m,"",a));const h=o.match(/COMPONENT_REFNUMS="(.*?)"/)[1].split(",");c=h.map((e,m)=>n.mapRefnum(e,c,"Bom Component : Refnum",t,l,m,"Component",a));const g=o.match(/INVOLVED_PARTY="(.*?)"/)[1].split(",");d=g.map((e,m)=>n.mapInvolvedParty(e,d,"Bom : Involved Party",t,l,m,"",a)),r(m.default.uniqBy([...i,...p,...s,...d,...u,...f,...c],e=>e.name))})}function i(e,t,a,n){return new Promise(async function(r){const i=m.default.differenceWith(e,t,(e,m)=>e.name===m.name),p=m.default.differenceWith(t,e,(e,m)=>e.name===m.name);if(i.length>0){const e=await o.Bom(n,a).insertMany(i);r([...t,...e])}else p.length>0?(await o.Bom(n,a).deleteMany({_id:{$in:[...p.map(e=>e._id)]}}),r(m.default.differenceWith(t,p,(e,m)=>e.name===m.name))):r(t)})}function p(e){return a.SchemaBom.findOne({gtmVersion:e}).sort({_id:1})}exports.getBomSchema=t.default(p,{maxAge:6e4}),exports.getBomData=t.default(r,{maxAge:6e4}),exports.getUpdatedProp=t.default(i,{maxAge:6e4});
},{"../../models/bom":"yqlE","../../models/schemaBom":"fhQn","./bomProps":"d1Ga"}],"jRt1":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChilds=void 0;const t=require("../renamer"),r=e(require("lodash")),a=require("../other"),n=e=>{const t={};return r.default.keys(e).map(e=>o(e,t)).filter(e=>void 0!==e),t},o=(e,t)=>{switch(!0){case-1!==e.search("InvolvedParty"):s(e,t,"InvolvedParty");break;case-1!==e.search("Remark"):s(e,t,"Remark");break;case-1!==e.search("Refnum"):s(e,t,"Refnum");break;default:s(e,t,"Header")}return t};exports.getChilds=(e=>{const t={Bom:{},BomComponent:{}};return r.default.keys(e).map(r=>{switch(!0){case-1===r.search("GtmStructure"):break;case-1!==r.search("GtmStructureComponent"):m(r,e,t,"BomComponent");break;default:m(r,e,t,"Bom")}return t}).filter(e=>void 0!==e),t.Bom=n(t.Bom),t.BomComponent=n(t.BomComponent),{Bom:t}});const m=(e,t,r,a)=>{r[`${a}`][`${e}`]=t[`${e}`]},s=(e,n,o)=>{let m=e,s=e;switch(!0){case"InvolvedParty"===o:m=a.convertPath(e,"InvolvedParty").newPath,s=a.convertPath(e,"InvolvedParty").newName;break;case"Remark"===o:m=a.convertPath(e,"Remark").newPath,s=a.convertPath(e,"Remark").newName;break;case"Refnum"===o:m=a.convertPath(e,"Refnum").newPath,s=a.convertPath(e,"Refnum").newName}n[`${o}`]||(n[`${o}`]=[]),n[`${o}`].push({name:t.getElementName(s),path:m}),n[`${o}`]=r.default.uniqBy(n[`${o}`],"name")};
},{"../renamer":"jN2X","../other":"irtd"}],"Rmix":[function(require,module,exports) {
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function r(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){var t=o(e,"string");return"symbol"==typeof t?t:String(t)}function o(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateBomSchema=void 0;const i=require("./../index"),a=s(require("express")),u=a.default.Router(),m=s(require("path")),c=s(require("fast-xml-parser")),l=s(require("flat")),f=require("../helper/other"),d=require("../helper/Bom/schemaBomProps"),p=require("../models/schemaBom");async function g(){const e=m.default.join(i.ROOT_DIR,"XMLs","GtmStructure.xml"),r=await f.getFileData(e),n=c.default.getTraversalObj(r,{}),o=c.default.convertToJson(n,{}),s=l.default(o),a=d.getChilds(s);let{gtmVersion:u,xmlNsOtm:g,xmlNsGtm:O}=f.getXMlVersion(r);return u||(u=Number(f.CONSTS.GTMVERSION)),new p.SchemaBom(t({xmlNs:[g,O],gtmVersion:u},a)).save()}u.post("/",f.asyncRouteHandler(async(e,r)=>{const n=m.default.join(i.ROOT_DIR,"XMLs","GtmStructure.xml"),o=await f.getFileData(n),s=c.default.getTraversalObj(o,{}),a=c.default.convertToJson(s,{}),u=l.default(a),g=d.getChilds(u),{gtmVersion:O,xmlNsOtm:b,xmlNsGtm:y}=f.getXMlVersion(o);if(!O)return r.status(400).send("XML must contain Namespace");let h=await p.SchemaBom.findOne({gtmVersion:O});if(h){if(JSON.stringify(h.Bom)===JSON.stringify(g.Bom))return r.status(200).send(h);await p.SchemaBom.findByIdAndRemove(h._id)}return h=new p.SchemaBom(t({xmlNs:[b,y],gtmVersion:O},g)),h=await h.save(),r.status(200).send(h)})),u.get("/",f.asyncRouteHandler(async(e,t)=>{const{gtmVersion:r}=e.query;if(!r){const e=await p.SchemaBom.find().sort({gtmVersion:-1});return t.status(200).send(e)}const n=await p.SchemaBom.findOne({gtmVersion:r});return n?t.status(200).send(n):t.status(400).send(`gtmVersion:${r} schema not available!`)})),exports.default=u,exports.generateBomSchema=g;
},{"./../index":"Focm","../helper/other":"irtd","../helper/Bom/schemaBomProps":"jRt1","../models/schemaBom":"fhQn"}],"ZKMQ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),a=t.default.Router(),r=require("../helper/other"),s=require("../helper/dbXmlQuery"),n=require("../helper/Bom/getBomData"),o=require("../api/gtm"),i=require("../models/bom"),u=e(require("../middleware/auth")),d=require("./schemaBom");function l(e){return e.query.gtmVersion?+e.query.gtmVersion:+r.CONSTS.GTMVERSION}a.get("/",[u.default],r.asyncRouteHandler(async(e,t)=>{const{display:a}=e.query,{username:u,password:m,instance:p,url:c}=e.user,f=u.split(".")[0];if(a){const e=await i.Bom(f,p).find({$or:[{display:a},{disabled:!0}]}).sort({_id:1});if(e.length)return t.status(200).json({data:e})}const y=l(e);let g=await n.getBomSchema(y);g||(g=await d.generateBomSchema());const{data:B,error:h}=await r.asyncHandler(o.dbXml(c,s.getBomPropsfromGtm,u,m));if(h)return t.status(400).send(h);const w=await n.getBomData(g,y,B,f);let q=await i.Bom(f,p).find({}).sort({_id:1});return q&&0!==q.length?(q=await n.getUpdatedProp(w,q,p,f),a?t.status(200).json({data:q.filter(e=>e.display)}):t.status(200).json({data:q})):t.status(200).json({data:await i.Bom(f,p).insertMany(w)})})),a.put("/",[u.default],r.asyncRouteHandler(async(e,t)=>{let{bom:a}=e.body;const{username:r,instance:s}=e.user,n=r.split(".")[0];return a?(a=await i.Bom(n,s).findByIdAndUpdate(a._id,a,{new:!0}),t.status(200).json({data:a})):t.status(400).send("Bom prop value missing!")})),exports.default=a;
},{"../helper/other":"irtd","../helper/dbXmlQuery":"bJb7","../helper/Bom/getBomData":"KGb3","../api/gtm":"KJs0","../models/bom":"yqlE","../middleware/auth":"MNoc","./schemaBom":"Rmix"}],"BW02":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("body-parser")),u=e(require("../routes/auth")),a=e(require("../routes/user")),t=e(require("../routes/transmission")),s=e(require("../routes/orderRelease")),i=e(require("../middleware/error")),o=e(require("../routes/schemaItem")),d=e(require("../routes/schemaRelease")),l=e(require("../routes/item")),n=e(require("../routes/location")),m=e(require("../routes/schemaLocation")),c=e(require("../routes/party")),p=e(require("../routes/schemaParty")),f=e(require("../routes/transaction")),h=e(require("../routes/schemaTransaction")),q=e(require("../routes/orderBase")),b=e(require("../routes/schemaOrderBase")),g=e(require("../routes/audit")),v=e(require("../routes/setting")),y=e(require("../routes/trackingEvent")),_=e(require("../routes/schemaTrackingEvent")),k=e(require("../routes/shipment")),x=e(require("../routes/schemaShipment")),B=e(require("../routes/bom")),j=e(require("../routes/schemaBom"));function E(e){e.use(r.default.json({limit:"50mb"})),e.use(r.default.urlencoded({limit:"50mb",extended:!0})),e.use("/api/auth",u.default),e.use("/api/user",a.default),e.use("/api/audit",g.default),e.use("/api/item",l.default),e.use("/api/order-release",s.default),e.use("/api/location",n.default),e.use("/api/party",c.default),e.use("/api/bom",B.default),e.use("/api/transaction",f.default),e.use("/api/order-base",q.default),e.use("/api/tracking-event",y.default),e.use("/api/shipment",k.default),e.use("/api/schema/item",o.default),e.use("/api/schema/order-release",d.default),e.use("/api/schema/location",m.default),e.use("/api/schema/party",p.default),e.use("/api/schema/bom",j.default),e.use("/api/schema/transaction",h.default),e.use("/api/schema/order-base",b.default),e.use("/api/schema/tracking-event",_.default),e.use("/api/schema/shipment",x.default),e.use("/api/transmission",t.default),e.use("/api/settings",v.default),e.use(i.default)}exports.default=E;
},{"../routes/auth":"hXw8","../routes/user":"zMRv","../routes/transmission":"oAdS","../routes/orderRelease":"aCHs","../middleware/error":"mbXe","../routes/schemaItem":"RPHv","../routes/schemaRelease":"woBX","../routes/item":"o5f2","../routes/location":"pk3O","../routes/schemaLocation":"ZmvT","../routes/party":"TT7J","../routes/schemaParty":"abiS","../routes/transaction":"F2tt","../routes/schemaTransaction":"DV7a","../routes/orderBase":"Xt3B","../routes/schemaOrderBase":"KJCd","../routes/audit":"YYHk","../routes/setting":"UddP","../routes/trackingEvent":"J2kM","../routes/schemaTrackingEvent":"WFgW","../routes/shipment":"Dxzj","../routes/schemaShipment":"oS06","../routes/bom":"ZKMQ","../routes/schemaBom":"Rmix"}],"K5BP":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("winston")),o=e(require("mongoose")),n=require("../helper/other");function r(){const e=n.CONSTS.DB;o.default.connect(e,{useNewUrlParser:!0,useCreateIndex:!0,useFindAndModify:!1,useUnifiedTopology:!0}).then(()=>t.default.info(`Connected to ${e}...`))}exports.default=r;
},{"../helper/other":"irtd"}],"GM52":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../helper/other");function r(){if(!e.CONSTS.JWT_PRIVATE_KEY)throw new Error("FATAL ERROR: jwtPrivateKey is not defined.")}exports.default=r;
},{"../helper/other":"irtd"}],"Q010":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var i={};if(null!=r)for(var u in r)"default"!==u&&Object.hasOwnProperty.call(r,u)&&e(i,r,u);return t(i,r),i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const u=r(require("joi")),n=i(require("joi-objectid"));function o(){u.objectId=n.default(u)}exports.default=o;
},{}],"uPYR":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("helmet")),u=e(require("compression"));function r(e){e.use(t.default()),e.use(u.default())}exports.default=r;
},{}],"DxCk":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("./logging")),t=e(require("./routes")),u=e(require("./db")),i=e(require("./config")),d=e(require("./validation")),l=e(require("./prod"));exports.default=(e=>{r.default(),t.default(e),u.default(),i.default(),d.default(),l.default(e)});
},{"./logging":"yaW9","./routes":"BW02","./db":"K5BP","./config":"GM52","./validation":"Q010","./prod":"uPYR"}],"Focm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ROOT_DIR=void 0;const t=e(require("winston")),r=e(require("express")),i=e(require("cors")),u=e(require("./startup")),s=e(require("body-parser")),n=e(require("path")),d=r.default();d.use(i.default()),d.use(s.default.json({limit:"50mb"})),d.use(s.default.urlencoded({limit:"50mb",extended:!0,parameterLimit:5e4})),u.default(d),d.use(r.default.static(n.default.join(__dirname,"public"))),d.get("**",(e,t)=>t.sendFile(n.default.join(__dirname,"public","index.html")));const o=process.env.PORT||5e3,a=d.listen(o,l());function l(){return()=>t.default.info(`Listening on port ${o}...`)}exports.default=a,exports.ROOT_DIR=__dirname;
},{"./startup":"DxCk"}]},{},["Focm"], null)